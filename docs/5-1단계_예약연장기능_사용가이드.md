# 5-1단계: 예약 연장 기능 사용 가이드

## 개요

Pronto 서비스의 예약 연장 기능은 고객이 이용 중인 예약을 30분 단위로 연장할 수 있는 기능입니다. 예약 종료 후 10분 이내(Grace Period)에만 연장이 가능하며, 보유한 적립 시간과 쿠폰을 우선적으로 사용합니다.

## 주요 기능

### ✨ 핵심 특징
- **Grace Period**: 예약 종료 후 10분 이내에만 연장 가능
- **30분 단위 연장**: 30분, 1시간, 1시간 30분, 2시간 선택 가능
- **보유 시간 우선 사용**: 적립 시간 → 쿠폰 → 결제 순서로 차감
- **실시간 가용성 확인**: 다음 시간대 예약 충돌 실시간 검사
- **운영시간 제한**: 연장 후에도 운영시간(09:00-22:00) 내에서만 가능

### 🔒 제약 사항
- 예약 상태가 '확정' 또는 '수정'인 경우에만 가능
- Grace Period(10분) 내에서만 연장 가능
- 다음 시간대에 다른 예약이 있으면 연장 불가
- 연장 후 종료 시간이 운영시간을 초과하면 불가

## 사용 방법

### 1. 마이페이지에서 예약 연장하기

1. **마이페이지 접속**
   - 로그인 후 상단 메뉴에서 "마이페이지" 클릭
   - 또는 `/my` URL로 직접 접속

2. **이용 예정 탭 확인**
   - "이용 예정" 탭에서 현재 진행 중인 예약 확인
   - Grace Period 내에 있는 예약에 "예약 연장하기" 버튼 표시

3. **연장 버튼 클릭**
   - "예약 연장하기" 버튼 클릭
   - Grace Period 남은 시간이 실시간으로 표시됨

### 2. 연장 모달에서 설정하기

1. **연장 시간 선택**
   - 30분, 1시간, 1시간 30분, 2시간 중 선택
   - 각 옵션별 추가 요금이 실시간으로 계산됨

2. **보유 시간 사용 설정**
   - "적립 시간 사용": 보유한 적립 시간을 우선 사용
   - "쿠폰 사용": 사용 가능한 쿠폰 선택 (자동으로 최적 조합 제안)

3. **요금 확인**
   - 총 연장 요금에서 적립 시간과 쿠폰 할인을 제외한 금액 표시
   - "할인 전 요금 → 할인 후 요금" 형태로 표시

4. **연장 확인**
   - "예약 연장하기" 버튼 클릭하여 최종 확인
   - 연장 처리 중 로딩 상태 표시

### 3. 연장 완료 후

1. **예약 정보 업데이트**
   - 연장된 종료 시간으로 예약 정보 자동 업데이트
   - 적립 시간과 쿠폰 잔액 차감 반영

2. **연장 내역 확인**
   - 예약 상세 정보에서 연장 내역 확인 가능
   - 이용 내역에 연장 기록 추가

## 요금 계산 방식

### 💰 할인 적용 순서
1. **적립 시간 차감** (우선)
   - 보유한 적립 시간에서 연장 시간만큼 차감
   - 1분 = 시간당 요금 ÷ 60분

2. **쿠폰 차감** (다음)
   - 적립 시간으로 부족한 부분을 쿠폰으로 보충
   - 유효기간이 임박한 쿠폰부터 자동 사용

3. **추가 결제** (마지막)
   - 적립 시간과 쿠폰으로 부족한 부분만 결제
   - 실제 카드 결제는 Phase 8에서 구현 예정

### 📊 계산 예시
```
연장 시간: 1시간 (60분)
시간당 요금: 30,000원
연장 요금: 30,000원

보유 적립 시간: 20분 (10,000원 상당)
보유 쿠폰: 30분 쿠폰 (15,000원 상당)

계산 과정:
1. 적립 시간 사용: 20분 (10,000원)
2. 쿠폰 사용: 30분 (15,000원)  
3. 남은 시간: 10분 (5,000원)

최종 추가 결제: 5,000원
```

## 에러 상황별 대응

### ❌ 연장 불가능한 경우

1. **Grace Period 만료**
   - 메시지: "연장 가능 시간(Grace Period)이 만료되었습니다."
   - 대응: 예약 종료 후 10분 이내에 연장 시도

2. **다음 시간대 예약 충돌**
   - 메시지: "연장하려는 시간대에 이미 다른 예약이 있습니다."
   - 대응: 더 짧은 시간으로 연장하거나 다른 시간에 새 예약

3. **운영시간 초과**
   - 메시지: "연장 시간이 운영시간을 초과합니다."
   - 대응: 운영시간(22:00) 이내로 연장 시간 조정

4. **쿠폰 사용 불가**
   - 메시지: "일부 쿠폰을 사용할 수 없습니다."
   - 대응: 만료되지 않은 쿠폰만 선택하여 재시도

### ⚠️ 시스템 오류

1. **네트워크 오류**
   - 메시지: "네트워크 연결을 확인해 주세요."
   - 대응: 인터넷 연결 확인 후 재시도

2. **서버 오류**
   - 메시지: "서버 오류가 발생했습니다."
   - 대응: 잠시 후 재시도, 지속 시 고객센터 문의

3. **동시 연장 시도**
   - 메시지: "이미 처리 중인 연장 요청이 있습니다."
   - 대응: 처리 완료 후 재시도

## 실시간 정보 표시

### ⏰ Grace Period 카운트다운
```
예약 연장 가능 시간: 07:32 남음
```
- 초 단위로 실시간 업데이트
- 30초마다 서버와 동기화
- 0초가 되면 연장 버튼 비활성화

### 💵 실시간 요금 계산
```
연장 시간: 1시간
기본 요금: 30,000원
적립 시간 할인: -10,000원
쿠폰 할인: -15,000원
───────────────────
최종 결제 금액: 5,000원
```

## API 엔드포인트

### 개발자 참고용
```
GET /api/reservations/[id]/check-extension
POST /api/reservations/[id]/extend
```

자세한 API 명세는 별도 개발 문서 참조.

## 문의 및 지원

- **기술 문의**: 개발팀 Slack 채널
- **사용법 문의**: 고객센터 또는 FAQ 페이지
- **버그 신고**: GitHub Issues 또는 개발팀 직접 연락

---

*이 문서는 5-1단계 예약 연장 기능(2025-01-26)을 기준으로 작성되었습니다.* 