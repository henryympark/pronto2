# Pronto 서비스 단계별 개발 계획 v8.9 (2025년 5월 26일 업데이트)

*(참고: 본 문서는 PRD v4.24, 데이터베이스 스키마 v1.4, API 명세서 v1.4 기반으로 작성되었습니다.)*

**(변경 이력: v8.9 - 2025년 5월 26일, 현재 코드베이스 기반으로 실제 구현 상태 반영, Phase 1-3 완료 상태 업데이트, Phase 4 일부 완료 및 미완료 기능 명확히 구분; v8.8 - 2025년 5월 12일, Phase 3에 신규 단계(3-3) 추가 및 하위 단계 조정, 신규 Phase 6 추가 및 후속 Phase 순연, 이전 설명 텍스트 삭제; v8.7 - 2025년 5월 12일, 알림 관련 단계 명확화 (웹훅 발생과 실제 발송 분리), 테스트 단계 구체화, 용어 일관성 확보; v8.6 - 2025년 5월 12일, Phase 3 이후 재구성 (결제, 소셜 로그인, 알림톡 기능 후순위 배치); v8.5 - 2025년 5월 11일, Phase 1 완료 명시 및 Phase 2 이후 내용 최종 검토)**

---

## Phase 1: 핵심 예약 시스템 기반 구축 (이메일 인증 중심, 결제 시뮬레이션) (완료)

**Phase 1 목표:** 사용자가 **이메일 회원가입/로그인** 후 서비스를 탐색하고 시간을 선택하여 결제 없이 예약을 확정하는 최소 기능 구현. 운영자는 이메일 로그인 후 생성된 예약을 확인. 주요 기술 스택 연동 및 기본 동작 검증. (이 단계에서는 소셜 로그인, 실제 결제 연동 및 카카오 알림톡 발송은 제외합니다.)

### 1‑1단계: 프로젝트 초기 설정 (완료)

#### 목적

Next.js, TypeScript, Tailwind CSS 기반의 프론트엔드 프로젝트 구조를 설정하고 Supabase MCP 프로젝트를 생성 및 연동하여 개발 환경을 준비합니다.

#### 결과물

* 기본 설정이 완료된 Next.js 프로젝트 (create-next-app 활용, App Router, TypeScript 선택).
* Supabase MCP 프로젝트 생성 완료 및 해당 프로젝트의 API URL/anon key 환경 변수 설정 완료 (.env.local).
* Tailwind CSS 설치 및 `tailwind.config.js` 기본 설정 완료 (디자인 가이드 v3.3 색상 팔레트 일부 적용 준비).
* Supabase 클라이언트 라이브러리 `@supabase/supabase-js` 설치.

#### 대표 프롬프트

> Pronto 서비스 개발 시작할게, Next.js 최신 버전에 App Router랑 TypeScript 쓰는 걸로 프로젝트 만들고, UI용 Tailwind CSS 설치해서 디자인 가이드 v3.3 섹션 2 색상 팔레트 참고해서 tailwind.config.js에 커스텀 색상 넣을 준비까지 해줘, 그리고 Supabase Managed Cloud Platform에서 프로젝트 새로 파서 API URL이랑 anon key는 `.env.local` 파일에 환경 변수로 넣고 `@supabase/supabase-js` 라이브러리도 설치해놔. (참고: TDD v1.8 섹션 1)

#### 참고 문서

* Pronto 서비스 디자인 가이드 v3.3 (섹션 2: 색상 팔레트)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 1: 주요 기술 스택)

---

### 1‑2단계: 기본 레이아웃 컴포넌트 구현 (완료)

#### 목적

서비스 전체 페이지에 공통적으로 사용될 Header, Footer 레이아웃 컴포넌트를 디자인 가이드에 따라 구현합니다.

#### 결과물

* 재사용 가능한 **Header** 컴포넌트 (로고, 로그인/마이페이지 버튼 영역 포함, 반응형 동작).
* 재사용 가능한 **Footer** 컴포넌트 (저작권, 기본 정보 포함).
* 전역 레이아웃 파일 `app/layout.tsx`에 Header/Footer 적용 및 기본 페이지 구조(컨테이너, 패딩) 설정.
* 헤더 상단 고정 (**sticky**) 기능 구현.

#### 대표 프롬프트

> 이제 공통 레이아웃 만들자, 디자인 가이드 v3.3 섹션 4 보고 `Header`랑 `Footer` 컴포넌트 만들어서 전역 레이아웃(`app/layout.tsx`)에 적용해줘; Header는 로고 링크랑 버튼 영역 포함하고 스티키 고정, 모바일 햄버거 메뉴 구조 고려하고, Footer는 가이드 내용 채우고, 메인 영역은 컨테이너랑 기본 패딩 적용해. (참고: IA v1.6 섹션 3)

#### 참고 문서

* Pronto 서비스 디자인 가이드 v3.3 (섹션 4: 레이아웃 컴포넌트, 섹션 2: 색상 팔레트)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (섹션 3: 네비게이션 구조)

---

### 1‑3단계: 이메일 회원가입 및 로그인 구현 (운영자 포함) (완료)

#### 목적

사용자(고객 및 운영자)가 이메일 주소와 비밀번호를 사용하여 회원가입(고객)하고 로그인할 수 있도록 기본 인증 체계를 구축합니다.

#### 결과물

* 로그인 페이지(P‑001) UI 기본 구조 (이메일, 비밀번호 입력 폼, 로그인 버튼, 회원가입 링크).
* **(고객)** 회원가입 페이지(P‑000) UI 및 기능 구현 (정보 입력, 유효성 검사 – PRD F‑AUTH‑008 규칙 적용).
* **(고객)** 이메일 인증 메일 발송 및 인증 링크 클릭 시 Supabase Auth 통한 계정 활성화 처리 (`customers.is_active` 업데이트).
* **(고객 및 운영자)** 로그인 페이지(P‑001)에서 이메일/비밀번호 입력 폼 및 `supabase.auth.signInWithPassword` 함수 호출 로그인 기능 구현.
* 로그인 성공 시, 해당 사용자의 Supabase DB (customers 테이블) `role` 컬럼 확인 로직.
    * `role`이 `admin`이면 운영자 예약 현황 페이지(P‑101)로 리디렉션.
    * `role`이 `customer`이면 일반 사용자 페이지(P‑002) 또는 이전 요청 페이지로 리디렉션.
* Supabase 클라이언트를 통해 로그인 세션 유지 및 상태 관리 (예: Context API 또는 Zustand 사용).
* 로그인 상태에 따라 Header의 버튼 변경 (로그인 → 마이페이지/로그아웃).
* (별도 작업) Supabase 대시보드에서 운영자 계정 수동 생성 (Auth 및 customers 테이블 레코드 추가, `role='admin'` 설정).

#### 대표 프롬프트

> 이메일 기반 인증 시스템 먼저 만들자. 로그인 페이지(P-001)에는 이메일/비번 폼, 로그인 버튼, '이메일로 회원가입' 링크 넣어줘. '회원가입' 누르면 회원가입 페이지(P-000)로 가서 이메일, 비번(8자 이상, 영문/숫자/특문 조합), 이름, 폰번호 입력받고 유효성 검사해줘. 가입 누르면 `supabase.auth.signUp` 호출하고 이메일 인증 메일 보내고, 링크 누르면 계정 활성화되게 해줘. 로그인 페이지에서 이메일/비번으로 `signInWithPassword` 호출해서 로그인 처리하고, 성공하면 `customers` 테이블 `role` 확인해서 'admin'이면 P-101로, 'customer'면 P-002로 보내줘. 세션 유지랑 헤더 버튼 변경도 처리하고. 운영자 계정은 내가 미리 만들어둘게. (참고: PRD v4.21 F-AUTH-004~010, F-AUTH-017, TDD v1.8 인증, DB 스키마 v1.3 `customers`)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-AUTH-004 ~ F-AUTH-010, F-AUTH-017)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P-000, P-001, P-101)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 인증)
* Pronto 서비스 데이터베이스 스키마 v1.3 (customers 테이블)
* Supabase Auth Documentation (Email/Password, Email Auth, `signInWithPassword`)

---

### 1‑4단계: 서비스 상세 페이지 UI 구현 (기본 정보 및 예약 UI) (완료)

#### 목적

서비스 상세 페이지(P‑002)의 전체적인 UI 구조를 디자인 가이드에 맞춰 구현합니다 (데이터 연동 전).

#### 결과물

* P‑002 페이지 기본 라우트 `app/service/[serviceId]/page.tsx` 설정.
* IA 및 디자인 가이드 기반 반응형 레이아웃 구현 (lg 이상 2단, 이하 1단).
* 대표 이미지 표시 영역 (`<img>` 태그, placeholder 사용).
* **Service Info Card** UI 구조 (서비스명 `<h1>`, 설명 `<p>`, 가격/위치 정보 영역).
* **Tab Navigation** UI 구조 (탭 버튼들, 콘텐츠 영역).
* **Calendar Picker** 및 **Time Slot Picker** 영역 UI 구조 (버튼, 그리드 등 기본 틀).
* **'예약하기'** 버튼 및 하단 **Booking Form** 영역 UI 구조 (초기 숨김, div와 입력 필드 구조).

#### 대표 프롬프트

> 서비스 상세 페이지(P-002) UI 뼈대 만들어줘; `/service/[serviceId]` 경로 설정하고, IA 문서 v1.6 섹션 4랑 디자인 가이드 v3.3 섹션 3 (P-002) 참고해서 반응형 레이아웃(lg 이상 2단, 이하 1단) 잡아줘; 대표 이미지 영역, 기본 정보 카드, 탭 네비게이션 버튼들, 달력/시간 슬롯 영역, 그리고 '예약하기' 버튼 아래 숨겨진 예약 폼 영역까지 구조만 먼저 만들어줘.

#### 참고 문서

* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (섹션 4: 페이지 계층 구조 - P‑002, 섹션 7: URL 구조)
* Pronto 서비스 디자인 가이드 v3.3 (섹션 3: P‑002, 섹션 6: Breakpoints)

---

### 1‑5단계: 서비스 정보 조회 및 표시 (완료)

#### 목적

Supabase DB에서 서비스 정보를 조회하여 서비스 상세 페이지(P‑002)에 동적으로 표시합니다.

#### 결과물

* P‑002 페이지에서 URL 파라미터(`serviceId`)를 받아 Supabase DB `services` 테이블에서 해당 서비스 정보를 조회하는 로직 (Next.js 서버 컴포넌트 권장).
* 조회된 데이터를 Service Info Card UI(1‑4단계) 에 동적으로 채워넣는 기능 (이름, 설명, 가격, 위치, 이미지 URL 등). 이미지 URL은 `<img>` 태그의 `src` 속성에 적용.

#### 대표 프롬프트

> 이제 서비스 상세 페이지(P-002)에 진짜 정보 보여주자; 페이지 URL에서 `serviceId` 가져와서 Supabase `services` 테이블에서 해당 ID 서비스 정보(이름, 설명, 가격, 위치, 이미지 URL 등 PRD F-INFO-001에 명시된 필드) 조회해줘 (서버 컴포넌트 써서); 가져온 데이터를 1-4단계에서 만든 Service Info Card UI에 맞게 뿌려줘 (이미지는 src에 연결). (참고: DB 스키마 v1.3 `services` 테이블)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑INFO‑001)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`services` 테이블)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 2: 데이터 흐름)
* Supabase JS Client Documentation (Data Fetching)
* Next.js Documentation (Server Components, Dynamic Routes)

---

### 1‑6단계: 예약 가능 시간 조회 및 24시간 기준 시간 슬롯 UI 구현 (완료)

#### 목적

사용자가 선택한 날짜에 따라 예약 가능한 시간 정보를 조회하고, 24시간 기준 시간 슬롯 UI를 통해 PRD 규칙에 맞게 시간을 선택할 수 있도록 합니다.

#### 결과물

* **Calendar Picker** 컴포넌트 구현 (날짜 선택 시 상태 업데이트).
* 선택된 날짜의 예약 가능 시간 정보를 서버로부터 가져오는 **API 연동 기능** (예: `/api/v1/services/{serviceId}/available-times?date=YYYY-MM-DD` 호출하여 `operatingStartTime`, `operatingEndTime`, `unavailableSlots`, `isClosed`, `message`, `currentTime` 등 수신).
* 00:00부터 23:30까지 30분 단위로 표시되는 **24시간 기준 시간 슬롯 피커** 컴포넌트.
* 시간 흐름을 나타내는 **타임라인과 눈금 UI** (정각 눈금에는 "HH:00" 형식의 24시간제 레이블, 30분 눈금에는 "HH:30" 형식의 24시간제 레이블이 각 눈금 위치에 맞춰 표시되며, 각 30분 슬롯 내부에는 시간 텍스트를 표시하지 않음).
* 슬롯 상태 구분 (**사용 가능, 선택됨, 예약 불가, 비활성화**) 및 시각적 스타일.
* API 응답을 기반으로 서비스 운영 시간, 휴무일(`isClosed` 및 `message` 활용), 예약 불가능한 슬롯(`unavailableSlots`), 현재 시간(`currentTime` 활용) 등의 정보를 반영한 **시간 슬롯 활성화/비활성화 로직**.
* **시간 선택 자동화 기능 구현** (PRD v4.21 반영):
    * 최초 시간 선택 시 자동으로 1시간(2개 연속 슬롯) 선택.
    * 선택된 슬롯이 2개(1시간)만 남았을 때 그 중 하나를 클릭하면 전체 선택이 취소됨.
    * 연속되지 않은 새 위치 선택 시 해당 위치부터 1시간 자동 선택.
* 연속된 슬롯 선택 및 선택 시 **시작/종료 시간 표시** (총 이용 시간 포함).
* **'예약하기' 버튼 활성화/비활성화 상태 관리** (시간 선택 완료 시 활성화).

#### 대표 프롬프트

> 날짜/시간 선택 UI 만들자! 두 가지 컴포넌트가 필요해:
>
> 1. 캘린더 Picker: 날짜 선택하면 상태 업데이트되고 API 호출 필요해.
>
> 2. 24시간 기준 시간 슬롯 UI:
>    - 기본적으로 00:00부터 23:30까지 30분 단위 전체 슬롯 모두 표시해야 해.
>    - UI 상단에는 시간의 흐름을 나타내는 타임라인과 눈금을 그려줘:
>      * 정각 시간(06:00, 13:00 등)엔 굵은/높은 세로 눈금과 'HH:00' 형식의 24시간제 레이블 표시
>      * 30분 시간(06:30, 13:30 등)엔 얇은/짧은 세로 눈금과 'HH:30' 형식의 24시간제 레이블 표시
>      * 이 눈금과 레이블들은 각 슬롯의 시작 경계(왼쪽)에 정확히 맞춰서 배치해야 해
>    - 각 30분 슬롯은 두 눈금 사이 공간을 차지하며, 내부에 시간 텍스트 표시하지 않아
>    - 각 슬롯은 네 가지 상태 구분:
>      * 기본 상태(default): 선택 가능하지만 아직 선택 안 됨
>      * 선택됨(selected): 사용자가 선택한 슬롯
>      * 예약 불가(unavailable): 이미 예약되었거나 비즈니스 규칙으로 예약 불가한 슬롯
>      * 비활성(disabled): 운영 시간 외, 과거 시간 등으로 인해 선택 불가능한 슬롯
>
> 3. 날짜 선택 시 API 호출:
>    - GET `/api/v1/services/{serviceId}/available-times?date=선택한날짜`
>    - 응답에서 받는 정보: `operatingStartTime`, `operatingEndTime`, `unavailableSlots`, `isClosed`, `message`, `currentTime` 등
>    - 이 정보로 슬롯 상태 결정:
>      * `isClosed`: true면 전체 비활성화 + message 표시
>      * 운영 시간: `operatingStartTime` 이상 `operatingEndTime` 미만 슬롯만 활성화
>      * `unavailableSlots`: 이 배열에 포함된 슬롯은 예약 불가 상태로 표시
>      * 오늘 날짜면 `currentTime` 이전 슬롯 비활성화
>
> 4. 예약 가능/불가 상태 시각화 및 인터랙션 (API 연동):
>    - 휴무일 처리 (`isClosed: true`):
>      * 전체 슬롯 비활성화 + `message` 표시 (예: "정기 휴무일입니다")
>    - 운영 시간 및 예약 가능 슬롯 처리 (`isClosed: false`):
>      * `operatingStartTime` 미만의 슬롯은 비활성화
>      * `operatingEndTime` 이상의 슬롯은 비활성화 (정책 확정: `operatingEndTime` 미만 슬롯까지만 활성화)
>      * `unavailableSlots`에 포함된 슬롯은 예약 불가 상태로 표시
>      * 오늘 날짜인 경우 `currentTime` 이전 슬롯은 비활성화
>
> 5. 시간 범위 선택 인터랙션 (PRD v4.21 시간 선택 자동화 기능 반영):
>    - 클릭 또는 드래그로 연속된 활성 슬롯만 선택 가능
>    - 최초 시간 선택 시 자동으로 1시간(2개 연속 슬롯) 선택
>    - 선택된 슬롯이 2개(1시간)만 남았을 때 그 중 하나를 클릭하면 전체 선택이 취소됨
>    - 연속되지 않은 새 위치 선택 시 해당 위치부터 1시간 자동 선택
>    - 시작/종료 시간 표시: 선택된 슬롯의 시작, 종료 시간과 총 시간 계산해서 표시
>
> 참고: PRD v4.21 F-INFO-003, F-RESV (시간 선택 관련), TDD v1.8 섹션 4-2와 9-1, 디자인 가이드 v3.3 섹션 5 (TimeSlotPicker), IA v1.6 (TimeSlotPicker), API 명세서 v1.3 GET /api/v1/services/{serviceId}/available-times

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-INFO-003, F-RESV 관련)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4-2, 섹션 9-1)
* Pronto 서비스 디자인 가이드 v3.3 (P-002, TimeSlotPicker)
* Pronto 서비스 정보 구조(IA) v1.6 (TimeSlotPicker, `/my/reservations/{reservationId}/extend`)
* Pronto 서비스 API 명세서 v1.3 (`GET /services/{serviceId}/available-times`, `POST /reservations/{id}/extend`)

---

### 1‑7단계: 예약 신청 처리 (결제 시뮬레이션) (완료)

#### 목적

사용자가 예약 정보를 입력하고 **'예약 완료 및 결제하기'** 버튼을 클릭하면, 실제 결제 없이 예약을 확정 처리합니다.

#### 결과물

* **'예약하기'** 버튼 클릭 시 Booking Form 표시 로직 (하단 확장).
* 이름 입력 필드 (필수) 기능 및 유효성 검사 구현.
* **'예약 완료 및 결제하기'** 버튼 클릭 시 로직:

  1. 이름 입력 유효성 검사.
  2. Supabase `reservations` 테이블에 예약 정보(로그인된 `customer_id`, URL의 `service_id`, 선택된 `start_time`, `end_time` 등) 삽입 (`status='confirmed'`, PortOne 연동 없음).
  3. DB 삽입 성공 시 결제 완료 페이지(P‑007)로 리디렉션.
  4. DB 삽입 실패 시 사용자에게 오류 메시지 표시 (예: "예약 처리 중 오류 발생").

#### 대표 프롬프트

> '예약하기' 버튼 누르면 하단에 예약 폼(이름 입력칸 포함) 나오게 하고, 사용자가 이름 입력 후 '예약 완료 및 결제하기' 버튼 누르면 이름 체크하고 Supabase `reservations` 테이블에 예약 정보 저장해줘; 필요한 정보는 로그인된 사용자 ID, 서비스 ID, 선택된 시작/종료 시간 등이고 상태는 'confirmed'로. **결제는 아직 없으니 바로 저장**하고 성공하면 결제 완료 페이지(P-007)로 보내줘, 실패하면 에러 메시지 보여주고. (참고: PRD v4.21 F-RESV-005, F-RESV-016, TDD v1.8 예약 시스템)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑RESV‑005, F‑RESV‑016)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑007)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 예약 시스템)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블)
* Supabase JS Client Documentation (Inserting Data)

---

### 1‑8단계: 기본 마이페이지 구현 (예약 조회) (완료)

#### 목적

로그인한 사용자가 자신의 예약 내역 목록과 상세 정보를 확인할 수 있는 기본적인 마이페이지 기능을 구현합니다.

#### 결과물

* 마이페이지(P‑005) 기본 라우트 `/my` 및 레이아웃 구현 (Header, Footer 포함).
* 페이지 진입 시, 현재 로그인된 사용자의 ID로 Supabase `reservations` 테이블 조회하여 예약 목록 가져오는 로직.
* 조회된 예약 목록(서비스명, 예약 날짜/시간, 상태 등)을 리스트 또는 카드 형태로 표시 (최신순 정렬).
* 예약 항목 클릭 시 해당 예약의 상세 정보(요청사항 등 추가 정보)를 보여주는 기능 (모달 권장).

#### 대표 프롬프트

> 마이페이지(P-005) 기본 화면 만들자; 로그인 사용자가 접속하면 Supabase `reservations` 테이블에서 자기 예약 내역 가져와서 목록(서비스명, 날짜/시간, 상태 포함, 최신순)으로 보여줘; 목록 항목 누르면 상세 정보(요청사항 등) 볼 수 있게 모달 띄워주고. (참고: PRD v4.21 F-MGMT-U-001, F-MGMT-U-002, IA v1.6 P-005)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑U‑001, F‑MGMT‑U‑002)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑005)
* Pronto 서비스 디자인 가이드 v3.3 (섹션 3: P‑005)
* Supabase JS Client Documentation (Querying Data with Filters and Sorting)

---

### 1‑9단계: 기본 운영자 페이지 구현 (예약 조회, 서비스 정보 관리) (완료)

#### 목적

운영자가 로그인 후 전체 예약 목록 및 상세 정보를 확인하고, 기본적인 서비스 정보를 수정할 수 있도록 합니다.

#### 결과물

* 운영자 전용 **Admin Layout** 및 사이드바 기본 구조 구현 (메뉴 링크 포함).
* **예약 현황 페이지(P‑101)** 구현: Supabase `reservations` 테이블(+`customers` 조인)에서 모든 예약 목록 조회 및 테이블 표시, 예약 상세 정보 모달.
* **서비스 정보 관리 페이지(P‑106)** 구현: 현재 `services` 정보 조회 및 수정 폼 제공. 이미지 업로드(Supabase Storage 연동) 및 텍스트 정보 수정 후 DB 업데이트 기능.
* `/admin/*` 경로 접근 제어 로직 구현 (Supabase RLS 또는 Next.js Middleware로 `role='admin'` 사용자만 접근 허용).

#### 대표 프롬프트

> 운영자 페이지 만들자; 먼저 관리자용 레이아웃(사이드바 메뉴 포함) 만들고; 예약 현황 페이지(P-101)에서는 모든 예약 목록을 Supabase `reservations` 테이블(+`customers` 조인)에서 가져와 테이블로 보여주고, 예약 누르면 상세 정보 모달로 보여줘; 서비스 정보 관리 페이지(P-106)에서는 `services` 테이블 정보 가져와 폼에 뿌려주고, 이름/설명/가격/이미지 수정해서 저장 누르면 Supabase DB랑 Storage에 반영되게 해줘 (이미지 업로드 포함); 마지막으로 `/admin` 경로는 로그인했고 role이 'admin'인 사람만 접근 가능하게 막아줘 (RLS나 미들웨어 써서). (참고: PRD v4.21 F-MGMT-O-003, F-MGMT-O-004, F-MGMT-B-001, F-MGMT-B-002, TDD v1.8 인증/접근제어)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑O‑003, F‑MGMT‑O‑004, F‑MGMT‑B‑001, F‑MGMT‑B‑002)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑101, P‑106)
* Pronto 서비스 디자인 가이드 v3.3 (섹션 4: Admin Layout)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 인증 - 운영자 구분, 섹션 6: 데이터 접근 제어)
* Supabase Documentation (RLS, Storage)
* Next.js Documentation (Middleware)

---

## Phase 2: 이메일 인증 기반 사용자 관리 기능 강화 (완료)

**Phase 2 목표:** 이메일 로그인 사용자를 위한 비밀번호 찾기/재설정 기능 및 회원 탈퇴 기능을 구현하여 사용자 관리 편의성을 증대합니다. (소셜 로그인은 Phase 8에서 구현)

### 2‑1단계: 비밀번호 찾기/재설정 구현 (완료)

#### 목적

이메일 로그인 사용자가 비밀번호를 잊었을 경우 안전하게 재설정할 수 있도록 합니다.

#### 결과물

* **비밀번호 찾기 페이지(P‑010)** UI 및 이메일 입력 후 재설정 링크 요청 기능.
* `supabase.auth.resetPasswordForEmail` 함수 활용하여 재설정 링크 이메일 발송 로직.
* **비밀번호 재설정 페이지(P‑011)** UI 및 새 비밀번호 입력/확인 후 `supabase.auth.updateUser` 함수 활용한 변경 기능.

#### 대표 프롬프트

> 이메일 로그인용 비밀번호 찾는 기능 만들어줘; 로그인 페이지에 '비밀번호 찾기' 링크 넣고, 누르면 이메일 입력하는 페이지(P-010) 보여줘; 이메일 입력하고 버튼 누르면 `supabase.auth.resetPasswordForEmail` 함수 써서 재설정 링크 메일로 보내게 해; 사용자가 메일 링크 누르면 새 비번 설정하는 페이지(P-011) 보여주고, 거기서 비번 바꾸면 `supabase.auth.updateUser` 함수 써서 DB에 반영되게. (참고: PRD v4.21 F-AUTH-011~F-AUTH-014)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑AUTH‑011  \~  F‑AUTH‑014)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑010, P‑011)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 인증)
* Supabase Auth Documentation (Password Reset)

---

### 2‑2단계: 회원 탈퇴 기능 구현 (완료)

#### 목적

사용자가 마이페이지에서 직접 회원 탈퇴를 신청하고 처리할 수 있도록 합니다.

#### 결과물

* 마이페이지(P‑005) **'계정 설정'** 영역에 **'회원 탈퇴'** 버튼 추가.
* 탈퇴 버튼 클릭 시 유의사항 안내 및 최종 확인 절차 UI (모달 또는 별도 페이지, 비밀번호 재입력 등).
* 탈퇴 확인 시 Supabase Edge Function 호출하여 `customers.is_active=false`, `deleted_at` 업데이트 및 현재 Supabase 세션 종료 처리.
* (별도 구현) 30일 후 익명화 처리를 위한 스케줄링된 Edge Function 구현.

#### 대표 프롬프트

> 마이페이지(P-005) 계정 설정 부분에 회원 탈퇴 기능 넣어줘; 버튼 누르면 탈퇴하면 어떻게 되는지 (적립/쿠폰 시간 없어짐 등) 알려주고 진짜 탈퇴할 건지 한 번 더 물어봐 (비번 다시 입력받는 거 좋음); 확인 누르면 Supabase Edge Function 호출해서 바로 계정 비활성화시키고(`customers` 테이블 is_active=false, deleted_at 기록) 로그아웃 처리해; 30일 지나면 개인정보 지우는 건 나중에 따로 함수 만들자. (참고: PRD v4.21 F-AUTH-019~F-AUTH-021)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑AUTH‑019  \~  F‑AUTH‑021)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑005)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 인증  - 회원 탈퇴)
* Supabase Edge Functions Documentation
* Supabase Cron Jobs Documentation

---

## Phase 3: 예약 및 사용자 참여 기능 고도화 (이메일 로그인 기반) ✅ **완료**

**Phase 3 목표:** 이메일 로그인 사용자를 중심으로 예약 편의성(정보 자동 완성, 차량 정보)을 높이고, 예약 변경 시 요금 변동 안내 및 추가/부분 환불 기반을 마련하며, 마이페이지 예약 내역 조회 기능을 고도화(필터링, 상세 상태 표시)하고, 리뷰 시스템(작성, 조회, 적립) 및 쿠폰 시스템(운영자 부여, 사용자 확인)의 핵심 로직을 구현합니다. (카카오 알림톡, 실제 결제 연동은 후순위)

### 3‑1단계: 예약 정보 자동 완성 및 차량 정보 추가 ✅ **완료**

#### 목적

예약 편의성 증대 및 필요 정보 수집.

#### 결과물

* 예약 폼(P‑002 하단) 표시 시, 로그인 사용자의 가장 최근 예약 정보를 Supabase `reservations` 테이블에서 조회하여 **이름, 업체명, 촬영 목적** 필드를 자동으로 채우는 기능 (조회 실패 시 빈칸).
* 예약 폼에 **차량번호 입력 필드(선택)** 와 **개인정보 동의 체크박스(필수)** UI 추가.
* 예약 확정 시(1‑7단계 로직 수정) 차량번호와 동의 여부를 Supabase `reservations` 테이블에 함께 저장하는 로직 추가.

#### 대표 프롬프트

> 예약 폼(P-002 아래) 나올 때, 로그인한 사용자가 전에 예약한 적 있으면 이름, 업체명, 촬영 목적 자동으로 채워주도록 해줘 (가장 최근 예약 기준, Supabase `reservations` 테이블 조회); 그리고 차량번호 입력칸(선택)이랑 개인정보 동의 체크박스(필수)도 추가해줘; '예약 완료 및 결제하기' 누를 때 이 정보들도 같이 `reservations` 테이블에 저장되게 하고. (참고: PRD v4.21 F-RESV-006~F-RESV-009)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑RESV‑006  \~  F‑RESV‑009)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블)

---

### 3‑2단계: 사용자 예약 변경/취소 로직 구현 (DB 업데이트 중심) ✅ **완료**

#### 목적

사용자가 예약을 직접 관리할 수 있는 기본 기능 제공 (카카오 알림톡 및 실제 환불 제외).

#### 결과물

* 마이페이지(P‑005) 예약 내역 목록에서 조건(변경: 1분 전, 취소: 31분 전)에 따라 **'예약 변경'**, **'예약 취소'** 버튼 노출 로직.
* **'예약 변경'** 클릭 시 예약 변경 페이지/모달(P‑008) 표시 및 새 시간 선택 UI 구현.
* 변경 완료 시 Supabase `reservations` 테이블 업데이트 로직 (`start_time`, `end_time`, `status='modified'`) **(동시성 제어 고려)**.
* **'예약 취소'** 클릭 시 확인 절차 후 Supabase `reservations` 테이블 상태 `cancelled` 업데이트 로직. (환불 API 호출은 제외)
* 예약 변경/취소 시 `booking.changed` / `booking.cancelled` 웹훅 이벤트 발생 지점 구현 (페이로드 정의는 API 명세서 참조, 실제 카카오 알림톡 발송은 Phase 8에서 연동).

#### 대표 프롬프트

> 마이페이지(P-005) 예약 목록에서 조건 맞으면 '예약 변경' (1분 전까지), '예약 취소' (31분 전까지) 버튼 보이게 해줘; '예약 변경' 누르면 시간 다시 고르는 UI(P-008) 보여주고, 새 시간 정해서 완료 누르면 Supabase `reservations` 테이블 시간 바꾸고 상태 'modified'로 업데이트하고 웹훅 이벤트 발생시켜줘. '예약 취소' 누르면 진짜 취소할 건지 물어보고 확인 누르면 상태만 'cancelled'로 바꾸고 웹훅 이벤트 발생시켜줘. 실제 카카오 알림톡이랑 환불은 Phase 8에서 붙일 거야. (참고: PRD v4.21 F-MGMT-U, F-MGMT-M, F-MGMT-C, TDD v1.8 예약 시스템, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑U‑003, F‑MGMT‑U‑004, F‑MGMT‑M, F‑MGMT‑C)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑008)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (예약 시스템 - 동시성 제어, 웹훅 이벤트 관련)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)

---

### 3‑3단계: 마이페이지 예약 내역 필터링 및 상세 상태 표시 기능 구현 ✅ **완료**

#### 목적

사용자가 마이페이지에서 자신의 예약 내역을 "이용 예정", "이용 완료", "취소 내역" 등으로 쉽게 필터링하고, 취소된 예약의 경우 "환불 처리 중", "환불 완료" 등 상세한 환불 상태를 확인할 수 있도록 하여 사용 편의성을 높입니다.

#### 결과물

* **마이페이지 예약 목록 필터링 UI 구현:**
    * "전체", "이용 예정", "이용 완료", "취소 내역" 등의 필터 옵션 제공 (탭 또는 드롭다운 형태).
    * (선택) "오늘 이용" 예약을 빠르게 확인할 수 있는 별도 표시 또는 필터 옵션.
* **필터링 로직 및 API 연동:**
    * 선택된 필터 조건에 따라 예약 목록을 조회하는 API 호출 로직 구현 (기존 예약 목록 API에 필터 파라미터 추가 또는 신규 API).
        * "이용 예정": `status`가 'confirmed' 또는 'modified'이고, `end_time`이 현재 시간 이후인 예약.
        * "이용 완료": `status`가 'completed'인 예약 (또는 'confirmed'/'modified'이면서 `end_time`이 현재 시간 이전인 예약 포함 가능).
        * "취소 내역": `status`가 'cancelled'인 예약.
    * 필터 선택 시 해당 조건에 맞는 예약 목록으로 동적 업데이트.
* **취소 내역 상세 상태 표시:**
    * "취소 내역" 필터링 시, 각 예약 건에 대해 환불 상태를 텍스트로 명확히 표시:
        * "취소됨 (환불 완료: YYYY-MM-DD)": `status`='cancelled' AND `refunded`=true AND `refunded_at` IS NOT NULL.
        * "취소됨 (환불 처리 중/예정)": `status`='cancelled' AND `paid_amount` > 0 AND (`refunded`=false OR `refunded_at` IS NULL).
        * "취소됨 (환불 대상 아님)": `status`='cancelled' AND `paid_amount` = 0.
    * `reservations` 테이블의 `status`, `refunded`, `refunded_at`, `paid_amount` 필드를 조합하여 환불 상태 결정.

#### 대표 프롬프트

> 마이페이지(P-005)에서 예약 내역 볼 때, '이용 예정', '이용 완료', '취소 내역' 이렇게 나눠서 볼 수 있게 필터 기능 만들어줘. UI는 탭이나 드롭다운으로 하고, 선택하면 해당 예약들만 보이게 API 연동해줘. 특히 '취소 내역'에서는 그냥 '취소됨'이라고만 나오지 말고, '환불 완료'됐는지, 아니면 아직 '환불 처리 중'인지 같은 정보도 같이 보여주면 좋겠어. 돈 낸 게 없는 예약이 취소된 거면 그냥 '취소됨'으로만 표시하고. (참고: PRD v4.21 마이페이지 F-MGMT-U, DB 스키마 v1.3 `reservations` 테이블, 디자인 가이드 v3.3 P-005)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-MGMT-U - 마이페이지 예약 관리)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블 - status, refunded, refunded_at, paid_amount 필드)
* Pronto 서비스 디자인 가이드 v3.3 (P-005 마이페이지 UI/UX - 필터링 UI 추가 필요)
* Pronto 서비스 API 명세서 v1.3 (예약 목록 조회 API - 필터 파라미터 추가 또는 신규 API 정의 필요)

---

### 3‑4단계 (기존 3-3): 예약 변경 시 요금 변동 안내 및 추가/부분 환불 기반 마련 ✅ **완료**

#### 목적

사용자가 예약 변경 시 이용 시간이 변경됨에 따라 발생할 수 있는 요금 변동(추가 결제 또는 부분 환불)을 사전에 인지하고, 이에 대한 시스템적 처리 기반을 마련합니다. (실제 결제/환불 처리는 Phase 7에서 연동)

#### 결과물

* **요금 재계산 로직 구현:**
    * 예약 변경 UI(P-008)에서 사용자가 새로운 시간을 선택할 때마다, 변경된 시간에 따른 요금을 실시간으로 재계산하는 로직 (프론트엔드).
    * 기존 결제 금액(또는 예약 시점의 예상 금액)과 비교하여 예상 추가 결제 금액 또는 예상 부분 환불 금액을 사용자에게 명확히 표시.
* **사용자 안내 UI 개선:**
    * 예약 변경 UI에 예상 추가/환불 금액을 명확히 표시.
    * 추가 요금 발생 시: "시간 변경으로 인해 XXX원의 추가 요금이 발생합니다. 변경 완료 후 결제가 필요합니다." 와 같은 안내 메시지 표시. (실제 결제 버튼은 이 단계에서 비활성화 또는 미노출)
    * 부분 환불 발생 시: "시간 변경으로 인해 XXX원이 환불될 예정입니다. 환불 정책에 따라 처리됩니다." 와 같은 안내 메시지 표시. (실제 환불 처리는 이 단계에서 미진행)
* **백엔드 데이터 준비:**
    * 예약 변경 확정 시(`status='modified'`), 변경된 시간과 함께 재계산된 총 요금(또는 예상 변동액)을 `reservations` 테이블의 별도 필드(예: `recalculated_total_amount`, `pending_payment_amount`, `pending_refund_amount`)에 임시 저장하거나, 관련 로그를 기록하여 Phase 7에서 실제 결제/환불 처리 시 참조할 수 있도록 준비.

#### 대표 프롬프트

> 사용자가 예약 변경(3-2단계)할 때, 시간이 늘거나 줄면 요금도 바뀌잖아. 변경 UI에서 새로운 시간 고를 때마다 실시간으로 요금 다시 계산해서 추가로 돈 내야 하는지, 아니면 일부 돌려받을 수 있는지 사용자한테 명확하게 보여주도록 해줘. 만약 돈 더 내야 하면 "추가 결제 필요합니다"라고 알려주고, 돌려받을 돈 있으면 "환불 예정입니다"라고 안내해줘. 실제 결제나 환불은 나중에 Phase 7에서 할 거니까, 지금은 백엔드에 변경된 요금 정보만 잘 저장해두거나 기록해놔서 나중에 처리할 수 있게 준비만 해두자. (참고: PRD v4.21 F-MGMT-M, TDD v1.8 예약 시스템, DB 스키마 v1.3 `reservations` 테이블 확장 고려)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-MGMT-M - 예약 변경 관련 규칙)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (예약 시스템, 결제/환불 로직 개요)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블 - 요금 관련 필드 추가 고려)
* Pronto 서비스 디자인 가이드 v3.3 (P-008 예약 변경 UI 관련)

---

### 3‑5단계 (기존 3-4): 리뷰 작성/수정/삭제 및 조회 기능 구현 ✅ **완료**

#### 목적

사용자가 이용 완료 건에 대해 리뷰를 작성/관리하고, 다른 사용자들이 리뷰를 조회할 수 있도록 합니다.

#### 결과물

* 리뷰 작성/수정 UI(P‑009 – 별점, 텍스트(10\~100자), 이미지(최대 5장, Supabase Storage 연동)).
* `reviews` 테이블 저장/수정 로직.
* 마이페이지(P‑005) 리뷰 관리 기능(작성 버튼 조건부 노출, 내 리뷰 목록, 수정/삭제).
* P‑002 **후기 탭** 콘텐츠(리뷰 목록 – PRD 규칙 적용, 더보기/펼쳐보기).
* 평균 별점/리뷰 수 표시 기능 (DB 쿼리 또는 집계 값 사용).

#### 대표 프롬프트

> 리뷰 기능 만들자. 마이페이지(P-005) 예약 내역에서 끝난 건에 '리뷰 작성' 버튼, 누르면 리뷰 쓰는 모달(P-009) (별점, 글, 사진) 기능 넣고 `reviews` 테이블에 저장. 마이페이지 '내 리뷰' 탭에서 수정/삭제 가능하게. 서비스 상세(P-002) 후기 탭에는 리뷰 목록이랑 평균 별점/리뷰 수 표시. (참고: PRD v4.21 F-MGMT-R, F-INFO-004, F-INFO-005, IA v1.6 P-009, DB 스키마 v1.3 `reviews`)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑R, F‑INFO‑004, F‑INFO‑005)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑009)
* Pronto 서비스 디자인 가이드 v3.3 (P‑002, P-009)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reviews` 테이블)
* Supabase Storage Docs

---

### 3‑6단계 (기존 3-5): 적립 시간 부여 및 잔액 표시, 쿠폰 부여 및 확인 기능 구현 ✅ **완료**

#### 목적

리뷰 작성 시 적립 시간을 부여하고, 운영자가 쿠폰을 부여하며, 사용자가 보유 잔액/쿠폰을 확인할 수 있도록 합니다.

#### 결과물

* 리뷰 등록 시 `customers.accumulated_time_minutes` 업데이트 로직(트랜잭션).
* 마이페이지(P‑005)/운영자 고객 목록(P‑103) 적립 시간 잔액 표시.
* 운영자 고객 관리(P‑103) 내 쿠폰 부여 UI/기능 (`customer_coupons` 테이블 저장).
* 마이페이지(P‑005)/운영자 고객 목록(P‑103) 보유 쿠폰 정보 표시.
* (선택) 적립 시간 부여 또는 쿠폰 부여 시 관련 웹훅 이벤트 발생 지점 구현 (실제 카카오 알림톡 발송은 Phase 8).

#### 대표 프롬프트

> 리뷰 쓰면 10분 적립 시간 주고, 마이페이지랑 운영자 고객 목록에 잔액 표시해줘. 운영자는 고객한테 30분 쿠폰 줄 수 있게 하고, 이것도 마이페이지랑 운영자 고객 목록에서 확인 가능하게. 필요하면 적립/쿠폰 부여 시 웹훅 이벤트도 발생시키고. (참고: PRD v4.21 F-TIME-003, F-TIME-004, F-TIME-008, F-TIME-009, F-TIME-010, DB 스키마 v1.3 `customers`, `customer_coupons`, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서

* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑TIME‑003, F‑TIME‑004, F‑TIME‑008, F‑TIME‑009, F‑TIME‑010)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`customers`, `customer_coupons` 테이블)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)

---

## Phase 4: 운영자 기능 강화 및 서비스 내부 로직 완성 (결제/외부 알림 제외) 🔄 **일부 완료**

**Phase 4 목표:** 운영자의 서비스 관리 효율성을 높이는 기능(휴무일 설정, 리뷰 관리, 대리 예약 기반)을 구현하고, 적립/쿠폰 시간 사용 로직(DB 차감 포함) 등 서비스 내부 핵심 로직을 완성합니다. (실제 결제 및 카카오 알림톡 연동은 후순위)

### 4‑1단계: 운영자 휴무일 설정 기능 구현 🔄 **진행 중**

#### 목적
운영자가 예약 불가 날짜를 설정하여 예약 가능 시간을 제어합니다.

#### 현재 상태
- ✅ holidays 테이블 마이그레이션 SQL 생성 완료 (0016_create_holidays_table.sql)
- ✅ 예약 가능 시간 API에서 holidays 테이블 반영 로직 구현 필요
- ✅ 운영자 휴무일 설정 UI 구현 필요

#### 결과물
* 운영자 예약 설정 페이지(P‑102) UI 구현 (캘린더 기반 날짜 선택 또는 요일 체크박스, 저장 버튼).
* 설정된 휴무일 정보를 저장/삭제하는 로직 (Supabase DB `holidays` 테이블 또는 `services` 테이블 활용).
* 예약 가능 시간 조회 로직(1‑6단계) 수정: DB에서 휴무일 정보를 함께 조회하여 해당 날짜/시간 슬롯을 비활성화 처리.
#### 대표 프롬프트

> 운영자가 특정 날짜나 요일을 휴무일로 지정하는 페이지(P-102) 만들어줘; 달력에서 날짜 찍거나 요일 체크해서 저장하면 Supabase DB에 기록되고, 예약 가능 시간 보여줄 때(1-6단계 로직 수정) 이 휴무일 정보 반영해서 해당 날짜는 예약 못하게 막아줘; DB는 `holidays` 테이블 새로 만들어서 관리하자. (참고: PRD v4.21 F-MGMT-O-002, IA v1.6 P-102)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑O‑002)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑102)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`holidays` 테이블 고려)

---

### 4‑2단계: 운영자 고객 목록 조회 및 관리 기능 강화 ✅ **완료**

#### 목적
운영자가 고객 정보를 효율적으로 조회하고 관리(신규 등록 등)할 수 있도록 합니다.
#### 결과물
* 고객 목록 페이지(P‑103) UI 구현 (테이블 형태, 이름, 연락처, 가입 방식, 적립/쿠폰 시간 요약 등 표시). 페이지네이션 구현.
* (신규) 운영자 고객 추가 기능(P-104, 모달 또는 페이지) UI 및 `customers` 테이블 저장 로직.
#### 대표 프롬프트

> 운영자 고객 목록 페이지(P-103)에 `customers` 테이블 정보(이름, 연락처, 가입방식, 적립/쿠폰시간 요약 등) 표로 보여주고 페이지네이션 넣어줘. 그리고 운영자가 수동으로 신규 고객 등록하는 기능(P-104)도 추가해주고. (참고: PRD v4.21 F-MGMT-O-005, F-MGMT-O-006, IA v1.6 P-103, P-104)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑O‑005, F‑MGMT‑O‑006)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑103, P‑104)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`customers` 테이블)

---

### 4‑3단계: 운영자 예약 변경/취소 기능 (DB 업데이트 중심) ✅ **완료**

#### 목적
운영자가 시간 제약 없이 예약을 관리(변경/취소)할 수 있도록 합니다. (카카오 알림톡 및 실제 환불 제외)

#### 현재 상태
- ❌ 운영자 예약 변경/취소 기능 미구현
- ❌ 예약 상세 페이지에서 변경/취소 버튼 미구현
#### 결과물
* 예약 상세(P‑101) 내 **변경/취소** 버튼 추가.
* 운영자용 예약 변경 UI (P‑008 유사) 및 DB 업데이트 로직 (`status='modified'`).
* 취소 확인 및 DB 상태 변경 로직 (`status='cancelled'`). (환불 API 호출은 제외)
* 운영자에 의한 예약 변경/취소 시 관련 웹훅 이벤트 발생 지점 구현 (실제 카카오 알림톡 발송은 Phase 8).
#### 대표 프롬프트

> 운영자가 예약 상세(P-101)에서 시간 제한 없이 예약 변경/취소할 수 있게 해줘; 변경 누르면 시간 다시 고르는 UI(사용자 꺼랑 비슷하게) 나오고 DB 업데이트 후 웹훅 발생; 취소 누르면 확인 받고 상태만 'cancelled'로 변경 후 웹훅 발생. 실제 카카오 알림톡이랑 환불은 나중에. (참고: PRD v4.21 F-MGMT-O-012, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑O‑012)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑101)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)

---

### 4‑4단계: 운영자 리뷰 관리 기능 구현 ✅ **완료**

#### 목적
운영자가 리뷰를 관리(숨김/삭제)할 수 있도록 합니다.

#### 현재 상태
- ❌ 운영자 리뷰 관리 페이지(P-107) 미구현
- ❌ 리뷰 숨김/삭제 기능 미구현
#### 결과물
* **리뷰 관리 페이지(P‑107)** UI.
* 리뷰 목록 조회, **숨김/삭제** 기능 (`reviews` 테이블 업데이트).
#### 대표 프롬프트

> 운영자 리뷰 관리 페이지(P-107) 만들어서 리뷰 목록 보여주고, 각 리뷰 숨기거나 삭제하는 기능 넣어줘; 숨기면 `is_hidden` 값 바꾸고, 삭제하면 `deleted_at` 값 넣거나 진짜 지우거나 (정책 정해서). (참고: PRD v4.21 F-MGMT-R-011)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑R‑011)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑107)

---

### 4‑5단계: 운영자 대리 예약 기능 구현 (DB 저장 중심) ✅ **완료**

#### 목적
운영자가 고객 대신 예약 생성 및 메모 기록할 수 있도록 합니다. (결제 요청 카카오 알림톡 제외)

#### 현재 상태
- ❌ 운영자 대리 예약 페이지(P-105) 미구현
- ❌ 고객 검색/신규 등록 연동 기능 미구현
#### 결과물
* **대리 예약 페이지(P‑105)** UI.
* 고객 검색/신규 등록 연동, 시간 선택, 메모 입력, `reservations` 테이블 저장 로직 (`status='pending_payment'`, `admin_memo` 포함).
* `payment.request.created` 웹훅 이벤트 발생 지점 구현 (실제 결제 요청 카카오 알림톡 발송은 Phase 8).
#### 대표 프롬프트

> 운영자 대리 예약 기능(P-105) 만들자; 고객 찾거나 새로 등록하고, 시간 고르고, 메모 남겨서 예약 생성(`status='pending_payment'`)하고, 결제 요청 알림을 위한 웹훅 발생까지만 해줘. 고객한테 카톡 보내는 건 Phase 8에서. (참고: PRD v4.21 F-MGMT-O-008~011, F-NOTI-005, IA v1.6 P-105, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑O‑008  \~  011, F‑NOTI‑005)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑105)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)

---

### 4‑6단계: 적립/쿠폰 시간 사용 로직 및 DB 차감 구현 ❌ **미구현**

#### 목적
예약 시 사용자가 선택한 적립/쿠폰 시간을 실제 DB에서 차감하고 예약 정보에 기록합니다. (실제 결제 연동 전 단계)

#### 현재 상태
- ❌ 예약 시 적립/쿠폰 시간 사용 로직 미구현
- ❌ DB 차감 및 트랜잭션 처리 미구현
#### 결과물
* 예약 폼(P‑002)에서 사용자가 적립/쿠폰 시간 사용 선택 시, 해당 정보(`used_coupon_ids`, `used_accumulated_time_minutes`)를 예약 정보와 함께 백엔드로 전달.
* 백엔드에서 예약 정보 저장 시(1-7단계에서 `status='confirmed'`로 저장되는 시점 또는 대리 예약 저장 시), 전달받은 사용 시간 정보를 바탕으로 `customers` 테이블의 `accumulated_time_minutes`를 실제로 차감하고, `customer_coupons` 테이블의 해당 쿠폰을 '사용됨' 상태로 업데이트하는 로직 구현 (트랜잭션 보장).
* `reservations` 테이블에 사용된 시간 정보 최종 기록.
#### 대표 프롬프트

> 이제 사용자가 예약할 때 적립금이나 쿠폰 쓰겠다고 선택하면, 진짜로 DB에서 해당 시간만큼 차감하고, 어떤 쿠폰 썼는지 기록하는 로직 만들어줘. 예약 정보 저장될 때 트랜잭션으로 한방에 처리되게. 아직 실제 돈 결제는 안 붙었으니까 DB 처리만 확실하게. (참고: PRD v4.21 F-TIME-007, TDD v1.8 웹훅 처리 부분 중 DB 업데이트 로직)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑TIME‑007 - 사용 시간 차감 관련)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (웹훅 처리 로직 중 DB 업데이트 부분 참조)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`customers`, `customer_coupons`, `reservations` 테이블)

---

## Phase 5: 예약 시스템 고도화 및 내부 테스트 ❌ **미구현**

**Phase 5 목표:** 예약 편의 기능(예약 연장 - DB 처리 중심)을 추가하고, 시스템 안정성(동시 예약 처리 - DB 제약 중심)을 확보하며, 시간 선택 UI 사용성을 개선합니다. 이 단계까지 구현된 기능에 대한 내부 통합 테스트를 수행합니다. (실제 결제, 카카오 알림톡, 소셜 로그인 연동은 후순위)

### 5‑1단계: 이용 중 예약 연장 기능 개발 (DB 처리 중심)

#### 목적
고객이 서비스 이용 중 또는 직후(Grace Period 내)에 예약을 연장할 수 있는 핵심 로직을 구현합니다. (실제 추가 결제 및 카카오 알림톡 제외)
#### 결과물
* **Front-end (Next.js):**
    * 마이페이지 예약 상세 내 "예약 연장하기" 버튼 및 연장 UI/UX 구현 (디자인 가이드 v3.3 - P-011, C-032 참조).
        * 연장 가능 시간 선택 (예: +30분 단위).
        * 추가 요금 실시간 계산 및 표시 (보유 적립/쿠폰 시간 자동 적용).
* **Back-end (Supabase Edge Function - 예: `extend-reservation`):**
    * 예약 연장 처리 로직 개발:
        * 사용자 인증 및 기존 예약 유효성 검증 (Grace Period 포함).
        * 다음 슬롯 실시간 가용성 확인.
        * 추가 요금 계산 (보유 시간 우선 차감).
        * DB 업데이트 (단일 트랜잭션 내 `reservations.end_time` 수정, 사용된 할인 정보 등 수정. `paid_amount`는 이 단계에서 미반영 또는 시뮬레이션).
        * (선택) 예약 연장 확정 시 `booking.extended` 웹훅 이벤트 발생 지점 구현 (실제 카카오 알림톡 발송은 Phase 8).
#### 대표 프롬프트

> 고객이 마이페이지에서 이용 중인 예약을 30분 단위로 연장하는 기능의 핵심 로직 만들어줘. 원래 예약 끝나고 10분(Grace Period) 안에 연장 가능, 다음 시간 비어있는지 실시간 확인. 추가금액 계산하고 보유 시간 먼저 쓰도록. 성공하면 DB에 예약시간 업데이트. 필요하면 웹훅 이벤트도 발생시키고. 실제 결제랑 카카오 알림톡은 나중에. (참고: PRD v4.21 F-RESV-017, TDD v1.8 섹션 4-X `extend-reservation`, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-RESV-017)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4-X)
* Pronto 서비스 디자인 가이드 v3.3 (P-011, C-032)
* Pronto 서비스 정보 구조(IA) v1.6 (`/my/reservations/{reservationId}/extend`)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)

---

### 5‑2단계: 동시간대 예약 처리 안정화 (DB 제약 중심)

#### 목적
여러 사용자가 동시에 같은 시간 슬롯에 예약을 시도할 경우 발생할 수 있는 중복 예약을 데이터베이스 레벨에서 방지합니다. (자동 환불 및 카카오 알림톡 제외)
#### 결과물
* **Database:**
    * `reservations` 테이블에 `(service_id, start_time)`에 대한 부분 고유 인덱스(`WHERE status = 'confirmed'`) 적용 및 검증 완료 (DB 스키마 v1.3 섹션 4-1 참조).
* **Back-end (예약 생성/확정 로직 보강):**
    * 예약 정보 DB 저장 시 UNIQUE 제약 조건 위반 오류를 적절히 처리하고, 프론트엔드에 실패를 알리는 로직 구현. (이 단계에서는 자동 환불 API 호출 및 카카오 알림톡 발송은 제외)
#### 대표 프롬프트

> 동시에 여러 사람이 같은 시간 예약 못하게 DB에서 막아줘. `reservations` 테이블에 `service_id`랑 `start_time` 조합으로 `confirmed` 상태 예약은 하나만 있게 UNIQUE 제약 걸고, 예약 정보 저장할 때 이 제약 어긋나면 에러 처리하고 사용자한테 예약 실패했다고 알려주게 해줘. 자동 환불이나 카카오 알림톡은 나중에. (참고: PRD v4.21 F-RESV-018, TDD v1.8 섹션 4-3 DB 트랜잭션 부분, DB 스키마 v1.3 `reservations` 제약조건)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-RESV-018)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4-3: 결제 - PortOne 결제 성공 웹훅 수신 시 DB 트랜잭션 및 UNIQUE 제약 조건 오류 처리 부분 참조)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블 제약 조건)

---

### 5‑3단계: 시간 선택 UI 기능 개선 (자동 선택 및 취소)

#### 목적
사용자가 시간 슬롯 피커를 더 편리하게 사용할 수 있도록, 최초 선택 시 1시간 자동 선택, 최소 1시간 선택 유지 중 취소 용이성, 그리고 비연속적 시간 선택 시의 편의성을 개선한다. (PRD v4.21 - 시간 선택 자동화 기능)
#### 결과물
* **Front-end (TimeSlotPicker 컴포넌트 수정):**
    * **최초 시간 선택 시 1시간 자동 선택:** 사용자가 비어있는 시간 슬롯을 처음 클릭하면, 해당 슬롯을 시작으로 하여 자동으로 연속된 2개의 슬롯(총 1시간)이 선택되도록 구현.
    * **최소 1시간 선택 유지 중 취소 용이성:** 사용자가 이미 1시간(2개 슬롯)만 선택한 상태에서, 선택된 두 슬롯 중 하나를 다시 클릭하면 전체 선택이 취소되도록 구현.
    * **비연속적 시간 선택 시 새 위치에서 1시간 자동 선택:** 사용자가 기존에 선택한 시간 범위와 연속되지 않는 새로운 시간 슬롯을 클릭하면, 기존 선택은 해제되고 새로 클릭한 위치부터 자동으로 1시간(2개 슬롯)이 선택되도록 구현.
    * 이 외의 시간 선택 규칙(30분 단위 확장/축소, 최소 1시간 유지 등)은 기존 PRD 정의를 따름.
#### 대표 프롬프트

> 시간 선택 UI 좀 더 편하게 바꿔줘. 사용자가 처음 시간 고를 때 자동으로 1시간(슬롯 2개) 선택되게 하고, 딱 1시간만 골라놨을 때 그 중 하나 누르면 전체 선택 취소되게 해줘. 그리고 만약 다른데 찍으면 기존꺼 풀리고 거기서부터 다시 1시간 자동 선택되게. (참고: PRD v4.21 시간 선택 자동화 기능, TDD v1.8 섹션 9-1 TimeSlotPicker, IA v1.6 TimeSlotPicker, 디자인 가이드 v3.3 TimeSlotPicker)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (시간 선택 자동화 기능 관련 명시)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 9-1: 타임 슬롯 피커 - 최소 1시간 선택 관련 기능)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (섹션 8: Time Slot Picker - 특징)
* Pronto 서비스 디자인 가이드 v3.3 (섹션 5: 시간 슬롯 피커 - 인터랙션)

---

### 5‑4단계: 내부 통합 테스트 및 안정화 (결제/외부 알림/소셜 로그인 제외)

#### 목적
Phase 1~5에서 구현된 모든 기능(이메일 인증 기반 예약, 리뷰, 적립/쿠폰 DB 처리, 운영자 기능, 예약 연장 DB 로직, 동시 예약 DB 제약, 시간 선택 UI 개선 등)에 대한 통합 테스트를 수행하고 버그를 수정하여 서비스 핵심 로직의 안정성을 확보합니다.
#### 결과물
* 통합 테스트 시나리오 및 테스트 케이스 문서화.
* 테스트 실행 결과 기록 및 식별된 버그 수정 완료.
* 핵심 기능의 비기능 요구사항(성능, 기본적인 보안) 점검 및 개선.
#### 대표 프롬프트

> 지금까지 만든 이메일 로그인 기반 핵심 기능들 전부 다 잘 돌아가는지 꼼꼼하게 테스트해보자. 테스트 케이스 만들어서 예약 생성/변경/취소 (DB처리만), 리뷰, 적립/쿠폰 시간 DB 차감, 운영자 기능들, 예약 연장 DB 로직, 동시 예약 DB 제약, 시간 선택 UI 개선 사항까지 시나리오별로 다 테스트하고 결과 기록해줘. 버그 찾으면 다 고치고, 기본적인 성능이나 보안 문제 없는지 체크하고 개선해줘. (참고: PRD v4.21 관련 기능 전체, TDD v1.8 관련 기능 전체)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (결제, 카카오 알림톡, 소셜 로그인 제외한 모든 관련 기능)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (결제, 카카오 알림톡, 소셜 로그인 제외한 모든 관련 기능)
* 모든 이전 단계 결과물

---

## Phase 6: 서비스 사용성 및 운영 효율성 향상을 위한 추가 기능 개발

**Phase 6 목표:** 사용자와 운영자 모두의 편의성을 높이고 서비스 완성도를 향상시키기 위한 추가 기능(예: FAQ 페이지, 운영자 대시보드 개선 등)을 개발합니다.

### 6‑1단계: FAQ 페이지 구현

#### 목적
자주 묻는 질문과 답변을 제공하여 사용자 문의를 줄이고 정보 접근성을 높입니다.
#### 결과물
* FAQ 데이터를 관리할 수 있는 간단한 DB 스키마 또는 Markdown 파일 구조 정의.
* 운영자가 FAQ 내용을 쉽게 추가/수정/삭제할 수 있는 관리 인터페이스 (P-10X, 신규).
* 사용자가 FAQ 목록을 보고 검색하거나 카테고리별로 확인할 수 있는 FAQ 페이지 (P-0XX, 신규) UI 및 기능 구현.
    * 질문 클릭 시 답변 확장/축소 기능.
    * 간단한 키워드 검색 기능.
#### 대표 프롬프트

> 사용자들이 자주 물어볼 만한 내용들(예약 방법, 환불 정책, 스튜디오 이용 규칙 등) 정리해서 보여주는 FAQ 페이지 만들자. 운영자는 관리자 페이지에서 FAQ 질문이랑 답변 쉽게 등록하고 수정할 수 있게 해주고, 사용자들은 FAQ 페이지에서 검색하거나 카테고리별로 질문 찾아서 답변 볼 수 있게. (참고: PRD v4.21 NF-USAB-003 사용 편의성, IA v1.6 신규 페이지 P-0XX, P-10X)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (NF-USAB-003 사용 편의성 관련)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (신규 페이지 P-0XX, P-10X 정의 필요)
* Pronto 서비스 디자인 가이드 v3.3 (FAQ 페이지 UI/UX 디자인 필요)

---

### 6‑2단계: 운영자 대시보드 기능 개선 (통계 및 요약 정보)

#### 목적
운영자가 서비스 주요 현황을 한눈에 파악할 수 있도록 대시보드(P-101)에 통계 및 요약 정보를 추가합니다.
#### 결과물
* 운영자 예약 현황 페이지(P-101) 상단 또는 별도 탭에 주요 지표 표시:
    * 당일/주간/월간 총 예약 건수 및 금액 (시뮬레이션 또는 실제 결제 연동 후 데이터 기반).
    * 신규 가입 고객 수.
    * 최근 리뷰 요약 (평점 추이 등).
* 관련 데이터를 조회하고 집계하는 백엔드 로직 구현.
* 시각적으로 이해하기 쉬운 차트 또는 카드 형태 UI 구현.
#### 대표 프롬프트

> 운영자가 관리자 페이지(P-101) 들어갔을 때 오늘 예약 몇 건인지, 이번 주 매출(예상)은 어떤지 같은 주요 정보 바로 볼 수 있게 대시보드 기능 좀 개선해주자. 간단한 통계나 요약 정보 카드 형태로 보여주면 좋을 것 같아. (참고: PRD v4.21 F-MGMT-O-003 운영자 예약 현황 조회, TDD v1.8 운영자 기능)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-MGMT-O-003)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (운영자 기능 관련)
* Pronto 서비스 디자인 가이드 v3.3 (P-101 대시보드 UI 개선 디자인 필요)

---

*(...필요에 따라 Phase 6의 하위 단계를 추가 정의합니다. 예를 들어, "이용약관/개인정보처리방침 페이지 구현", "운영자 알림 설정 기능" 등...)*

---

## Phase 7 (기존 Phase 6): 결제 시스템 연동 및 관련 기능 구현

**Phase 7 목표:** PortOne 결제 시스템을 연동하고, 실제 결제가 포함된 예약 확정, 예약 연장, 예약 취소(환불), 동시 예약 시도(자동 환불) 및 예약 변경에 따른 차액 결제/환불 기능을 구현합니다.

### 7‑1단계 (기존 6-1): PortOne 결제 연동 (결제 페이지)

#### 목적
결제 페이지(P‑006)에 PortOne 연동하여 실제 결제를 진행합니다.
#### 결과물
* P‑006 UI, PortOne SDK 연동 및 결제 창 호출 로직.
#### 대표 프롬프트

> 이제 진짜 결제 붙이자; 결제 페이지(P-006) 만들고 PortOne SDK 연동해서 결제 창 띄우는 기능 구현해줘; 주문 ID랑 최종 결제 금액 넘겨주고. (참고: PRD v4.21 F-RESV-015, TDD v1.8 결제 연동, PortOne 가이드)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑RESV‑015)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑006)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (결제 연동)
* PortOne 가이드

---

### 7‑2단계 (기존 6-2): 적립/쿠폰 시간 할인 실제 결제 반영

#### 목적
예약 시 선택한 할인 금액을 실제 PortOne 결제 요청에 반영합니다.
#### 결과물
* 결제 페이지(P‑006)로 최종 할인 금액 전달 로직 수정.
* PortOne 결제 요청 시 할인된 금액 사용 로직 수정.
#### 대표 프롬프트

> 4-6단계에서 계산한 최종 할인 금액이 결제 페이지(P-006)로 잘 넘어가고, PortOne 결제 요청할 때 이 금액으로 요청되도록 수정해줘. (참고: PRD v4.21 F-TIME-006, TDD v1.8 결제 연동)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑TIME‑006)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (결제 연동)

---

### 7‑3단계 (기존 6-3): PortOne 결제 웹훅 처리, 예약 확정, DB 업데이트 및 관련 웹훅 발생

#### 목적
PortOne 웹훅을 수신/검증한 뒤 예약 상태를 확정하고, 사용된 적립/쿠폰 시간을 DB에서 차감하며, 결제 정보를 저장하고, 관련 웹훅(예약 확정, 동시 예약 실패)을 발생시킵니다.
#### 결과물
* 웹훅 수신 Edge Function (`handle-payment-webhook`).
* 웹훅 검증 및 PortOne 재확인 로직.
* DB 업데이트 로직 (`reservations.status='confirmed'`, `paid_amount`, `payment_id` 등 저장, `customers.accumulated_time_minutes` 차감, `customer_coupons` 사용 처리 – 트랜잭션).
* (동시 예약 처리) UNIQUE 제약 조건 위반 시 트랜잭션 롤백, PortOne 환불 API 자동 호출 로직 구현 및 `booking.failed.concurrent` 웹훅 이벤트 발생.
* 예약 확정 성공 시 `booking.confirmed` 웹훅 이벤트 발생 (실제 카카오 알림톡 발송은 Phase 8에서 연동).
#### 대표 프롬프트

> PortOne 결제 웹훅 받는 Edge Function 만들어서, 웹훅 검증하고 PortOne에 다시 확인해줘. 문제 없으면 DB 트랜잭션 안에서 예약 상태 'confirmed'로 바꾸고, 결제 금액, 결제 ID 저장하고, 사용한 쿠폰/적립 시간도 DB에서 차감해줘. 그리고 예약 확정됐다고 `booking.confirmed` 웹훅 발생시켜줘. 만약 다른 사람이 먼저 예약해서 DB 저장 실패하면, 바로 PortOne 환불 API 호출해서 자동 환불 처리하고 `booking.failed.concurrent` 웹훅 발생시켜줘. 실제 카카오 알림톡은 Phase 8에서 붙일 거야. (참고: PRD v4.21 F-RESV-016, F-TIME-007, F-RESV-018, F-NOTI-001, F-NOTI-008, TDD v1.8 웹훅 처리 및 동시 예약 처리, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑RESV‑016, F‑TIME‑007, F‑RESV‑018, F-NOTI-001, F-NOTI-008)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (웹훅 처리, 동시 예약 처리 로직, 웹훅 이벤트 관련)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블 제약 조건)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)
* PortOne 가이드

---

### 7‑4단계 (기존 6-4): PortOne 환불 연동 (사용자/운영자 예약 취소 시)

#### 목적
사용자 또는 운영자에 의한 예약 취소 시 PortOne 환불 API를 호출하여 실제 환불을 처리합니다.
#### 결과물
* 사용자 예약 취소 로직(3-2단계) 및 운영자 예약 취소 로직(4-3단계) 수정:
    * Edge Function 활용, PortOne 환불 API 호출 추가.
    * 환불 성공 시 DB 상태 변경(`status='cancelled'`, `refunded=true`, `refunded_at` 기록), 실패 시 오류 처리.
    * 환불 완료 후 `booking.cancelled` 웹훅 이벤트 발생 (실제 카카오 알림톡 발송은 Phase 8).
#### 대표 프롬프트

> 이제 예약 취소하면 진짜 환불되게 만들자. 사용자 예약 취소(3-2단계)랑 운영자 예약 취소(4-3단계) 로직에 PortOne 환불 API 호출 기능 넣어줘. PortOne 거래 ID 찾아서 넘기고, 환불 성공해야 DB 상태 'cancelled'로 바꾸고 환불 정보 기록 후 `booking.cancelled` 웹훅 발생시켜줘. 실패하면 에러 처리. 실제 카카오 알림톡은 Phase 8에서. (참고: PRD v4.21 F-MGMT-C, F-MGMT-O-012, F-NOTI-004, TDD v1.8 환불 처리, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑MGMT‑C, F‑MGMT‑O‑012, F-NOTI-004)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (환불 처리, 웹훅 이벤트 관련)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)
* PortOne 가이드

---

### 7‑5단계 (기존 6-5): 예약 연장 기능의 실제 결제 연동 및 관련 웹훅 발생

#### 목적
Phase 5-1에서 구현한 예약 연장 기능에 실제 추가 요금 결제 로직(PortOne 연동)을 추가하고, 연장 완료 시 웹훅을 발생시킵니다.
#### 결과물
* **Back-end (Supabase Edge Function - `extend-reservation` 수정):**
    * 추가 요금 발생 시 PortOne 결제 정보 생성 및 클라이언트로 전달.
    * 클라이언트로부터 PortOne 거래 ID 수신 후 검증.
    * DB 업데이트 시 `paid_amount`에 추가 결제액 누적, `extended_paid_amount` 업데이트.
    * 연장 및 결제 완료 후 `booking.extended` 웹훅 이벤트 발생 (실제 카카오 알림톡 발송은 Phase 8).
* **Front-end (연장 UI 수정):**
    * 추가 요금 발생 시 PortOne 결제 모듈 호출.
#### 대표 프롬프트

> 5-1단계에서 만든 예약 연장 기능에 이제 진짜 돈 결제 붙이자. 추가 요금 있으면 PortOne 결제 모듈 띄워서 결제 받고, 성공하면 DB에 결제 정보랑 연장된 내용 최종 업데이트하고 `booking.extended` 웹훅 발생시켜줘. 실제 카카오 알림톡은 Phase 8에서. (참고: PRD v4.21 F-RESV-017, F-NOTI-007, TDD v1.8 섹션 4-X `extend-reservation`, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-RESV-017, F-NOTI-007)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4-X, 웹훅 이벤트 관련)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)

---

### 7‑6단계: 예약 변경에 따른 추가 결제 및 부분 환불 처리

#### 목적
Phase 3-3에서 준비된 예약 변경으로 인한 요금 차액(추가 결제 또는 부분 환불)에 대해 실제 PortOne 결제 또는 환불을 처리합니다.
#### 결과물
* **추가 결제 처리:**
    * 예약 변경 UI(P-008)에서 추가 요금 발생 및 사용자가 변경을 확정한 경우, 해당 추가 금액에 대해 PortOne 결제 모듈 호출 로직 연동.
    * 추가 결제 성공 시, `reservations` 테이블의 `paid_amount` 업데이트 및 관련 결제 정보(예: `additional_payment_id`) 저장.
    * `booking.payment.updated` 또는 유사한 웹훅 이벤트 발생 (필요시, Phase 8에서 카카오 알림톡 연동).
* **부분 환불 처리:**
    * 예약 변경으로 인해 부분 환불이 필요한 경우, 백엔드에서 PortOne 환불 API를 호출하여 차액만큼 환불 처리.
    * 환불 성공 시, `reservations` 테이블의 `paid_amount` 업데이트 및 환불 정보(예: `partial_refund_amount`, `partial_refund_at`) 저장.
    * `booking.refund.partial` 또는 유사한 웹훅 이벤트 발생 (필요시, Phase 8에서 카카오 알림톡 연동).
* 관련 DB 필드(`recalculated_total_amount`, `pending_payment_amount`, `pending_refund_amount` 등)를 사용하여 정확한 금액 처리 및 상태 업데이트.

#### 대표 프롬프트
> 3-3단계에서 예약 변경할 때 요금 달라지는 거 안내했잖아. 이제 진짜로 돈 처리하는 부분 만들자. 시간 늘어서 돈 더 내야 하면 PortOne으로 추가 결제 받고, 시간 줄어서 돈 돌려줘야 하면 PortOne으로 부분 환불해줘. 성공하면 DB에 결제/환불 정보 잘 기록하고, 필요하면 관련 웹훅도 발생시켜서 Phase 8에서 카카오 알림톡 보낼 수 있게 준비해줘. (참고: PRD v4.21 F-MGMT-M, TDD v1.8 결제/환불 처리, API 명세서 v1.3 웹훅 이벤트, PortOne 가이드)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-MGMT-M - 예약 변경 관련 규칙)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (결제 처리, 환불 처리, 웹훅 이벤트 관련)
* Pronto 서비스 데이터베이스 스키마 v1.3 (`reservations` 테이블 - 요금 관련 필드)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록 - 필요시 신규 이벤트 정의)
* PortOne Developer Documentation (결제 및 부분 환불 API)

---

## Phase 8 (기존 Phase 7): 소셜 로그인, 알림 시스템 연동 및 최종 배포 준비

**Phase 8 목표:** 카카오/네이버 소셜 로그인 기능을 추가하고, 모든 종류의 카카오 알림톡 발송 시스템(Make/n8n 연동)을 구축하며, 서비스 전반의 최종 테스트, 안정화 및 실제 배포를 준비합니다.

### 8‑1단계 (기존 7-1): 카카오 로그인 구현

#### 목적
사용자가 카카오 계정을 통해 서비스에 로그인하고 인증 상태를 유지할 수 있도록 합니다.
#### 결과물
* 로그인 페이지(P-001)에 카카오 로그인 버튼 UI 추가.
* Supabase Auth Kakao Provider 설정 및 클라이언트 측 로그인 연동 로직 구현 (`supabase.auth.signInWithOAuth`).
* 카카오 로그인 성공 후 콜백 처리:
    * Supabase 클라이언트에서 사용자 정보(세션) 확인.
    * Supabase DB (customers 테이블)에서 해당 카카오 ID(`auth.users.id`) 사용자 조회.
    * 없으면 카카오 제공 정보(이름, 이메일 등)로 **customers** 테이블에 신규 레코드 생성 (`auth_provider='kakao'`, `role='customer'`, `id`는 `auth.users.id`와 동일).
    * 있으면 정보 업데이트 (선택 사항, 기존 계정과의 연결 정책 고려).
* 로그인 상태에 따라 Header의 버튼 변경 (로그인 → 마이페이지/로그아웃).
#### 대표 프롬프트

> 이제 카카오 로그인 기능 추가하자. 로그인 페이지(P-001)에 카카오 로그인 버튼 만들고, Supabase Auth Kakao Provider 설정해서 `signInWithOAuth` 호출해줘. 로그인 성공하면 콜백 받아서 Supabase 세션 확인하고, `customers` 테이블에서 해당 카카오 ID로 사용자 조회해서 없으면 새로 만들고(auth_provider='kakao', role='customer'), 이미 이메일 등으로 가입된 동일 이메일 사용자가 있으면 계정 연결 또는 안내 처리하고, 기존 카카오 사용자는 로그인 처리 후 세션 유지 및 헤더 버튼 업데이트 해줘. (참고: PRD v4.21 F-AUTH-002, F-AUTH-011, F-AUTH-017, TDD v1.8 인증, DB 스키마 v1.3 `customers`)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-AUTH-002, F-AUTH-011, F-AUTH-017)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P-001)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 인증)
* Pronto 서비스 데이터베이스 스키마 v1.3 (customers 테이블)
* Supabase Auth Documentation (Kakao Provider, signInWithOAuth, Session Management, Account Linking)

---

### 8‑2단계 (기존 7-2): 네이버 로그인 구현

#### 목적
사용자가 네이버 계정으로 서비스에 로그인할 수 있도록 로그인 옵션을 확장합니다.
#### 결과물
* 로그인 페이지(P‑001)에 네이버 로그인 버튼 UI 추가.
* Supabase Auth Naver Provider 설정 및 클라이언트 측 로그인 연동 로직 구현 (`supabase.auth.signInWithOAuth`).
* 네이버 로그인 성공 후 콜백 처리 (8-1단계 카카오 로그인과 유사하게 **customers** 테이블 처리 및 계정 연결 정책 고려).
#### 대표 프롬프트

> 네이버 로그인 기능도 추가하자. 로그인 페이지(P-001)에 네이버 로그인 버튼 추가하고, Supabase Auth Naver Provider 설정해서 `signInWithOAuth` 호출해서 로그인 처리해줘. 콜백 받으면 `customers` 테이블 확인해서 없으면 새로 만들고(auth_provider='naver', role='customer'), 있으면 카카오 로그인 때와 동일한 방식으로 계정 처리 및 로그인, 세션 유지, 헤더 버튼 업데이트까지 해줘. (참고: PRD v4.21 F-AUTH-003)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F‑AUTH‑003)
* Pronto 서비스 정보 구조 (IA) 문서 v1.6 (P‑001)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4: 인증)
* Supabase Auth Documentation (Naver Provider, Account Linking)

---

### 8‑3단계 (기존 7-3): 알림 시스템 구축 (Make/n8n 연동 및 전체 카카오 알림톡 구현)

#### 목적
이전 단계들에서 구현된 각 기능별 웹훅 이벤트를 Make/n8n에서 수신하여, 정의된 모든 카카오 알림톡(F-NOTI-001~011) 발송 시나리오를 구성하고 최종 테스트한다.
#### 결과물
* **Make/n8n 시나리오 구성 완료:**
    * `booking.confirmed` 웹훅 수신 → 예약 확정 카카오 알림톡(F-NOTI-001) 발송.
    * `booking.changed` 웹훅 수신 → 예약 변경 카카오 알림톡(F-NOTI-003) 발송.
    * `booking.cancelled` 웹훅 수신 → 예약 취소 카카오 알림톡(F-NOTI-004) 발송.
    * `payment.request.created` 웹훅 수신 → 대리 예약 결제 요청 카카오 알림톡(F-NOTI-005) 발송.
    * `booking.extended` 웹훅 수신 → 예약 연장 완료 카카오 알림톡(F-NOTI-007) 발송.
    * `booking.failed.concurrent` 웹훅 수신 → 동시 예약 실패 및 자동 환불 안내 카카오 알림톡(F-NOTI-008) 발송.
    * `review.request.needed` (스케줄링된 웹훅) 수신 → 리뷰 작성 요청 카카오 알림톡(F-NOTI-011) 발송.
    * `time.granted` (스케줄링 또는 이벤트 기반 웹훅) 수신 → 적립 시간 부여 카카오 알림톡(F-NOTI-010) 발송 (선택적).
    * 예약 만료 임박 알림 대상 웹훅 (스케줄링) 수신 → 예약 만료 15분 전 안내 카카오 알림톡(F-NOTI-006) 발송.
    * 예약 임박(1시간 전) 알림 대상 웹훅 (스케줄링) 수신 → 예약 임박 안내 카카오 알림톡(F-NOTI-002) 발송.
* 모든 카카오 알림톡 템플릿 검토 및 최종 확정.
* 카카오 알림톡 발송 실패 시 예외 처리 및 로깅 (Make/n8n 및 Supabase).
* 전체 알림 시나리오 테스트 완료 (실제 카카오톡 메시지 수신 확인).
#### 대표 프롬프트

> 이제 모든 카카오 알림톡 기능 완성하자. 이전 단계에서 만든 웹훅들(예약 확정, 변경, 취소, 결제 요청, 연장, 동시 예약 실패, 리뷰 요청, 적립 안내, 만료 임박, 1시간 전 임박)을 Make/n8n에서 받아서, PRD에 정의된 모든 카카오 알림톡(F-NOTI-001\~011)이 정확한 내용으로 발송되도록 시나리오 구성하고 테스트까지 완료해줘. 실패했을 때 로그도 잘 남게 하고. (참고: PRD v4.21 F-NOTI 전체, TDD v1.8 알림 시스템, API 명세서 v1.3 웹훅 이벤트)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (F-NOTI 관련 모든 요구사항)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 4-5: 알림 & 외부 연동, 카카오 알림톡 템플릿 목록)
* Pronto 서비스 API 명세서 v1.3 (웹훅 이벤트 목록)
* Make/n8n Documentation

---

### 8‑4단계 (기존 7-4): 사용자 경험(UX) 최종 검토, 성능/보안 테스트 및 강화

#### 목적
지금까지 개발된 모든 기능(소셜 로그인, 전체 알림 포함)에 대해 사용자 관점에서 플로우를 재검토하고, 서비스의 전반적인 성능과 보안을 최종적으로 테스트 및 강화하여 안정적인 서비스 운영 기반을 마련한다.
#### 결과물
* 주요 사용자 플로우(소셜 로그인 포함 모든 인증 방식, 예약, 결제, 환불, 연장, 리뷰, 카카오 알림 수신 등)에 대한 사용성 테스트 결과 및 개선 사항 목록.
* 식별된 UX 문제점 수정 완료.
* 모바일, 태블릿, 데스크탑 환경에서의 반응형 디자인 최종 점검 및 최적화.
* 주요 페이지 로딩 속도 및 API 응답 속도 측정 결과 (성능 목표 NF-PERF 충족 확인).
* 동시 접속 및 대량 데이터 처리 상황에서의 시스템 안정성 테스트 결과.
* 보안 취약점 점검 (XSS, SQL Injection, 인증/인가 로직 등) 결과 및 조치 내역 (보안 요구사항 NF-SECU 충족 확인).
* 데이터베이스 RLS 정책, 스토리지 접근 정책 최종 검토 및 강화.
* 개인정보 처리 관련 기능(탈퇴 시 익명화 등) 정상 동작 확인.
* 테스트 케이스 문서화 및 실행 결과 기록.
#### 대표 프롬프트

> 이제 진짜 마지막 점검이야. 소셜 로그인, 모든 카카오 알림까지 다 붙었으니까 사용자 입장에서 모든 기능 다시 한번 꼼꼼하게 써보면서 불편한 점 없는지, 디자인 깨지는 부분 없는지 최종 확인하고 고쳐줘. 그리고 서비스 오픈 전이니까 성능(페이지 속도, API 응답)이랑 보안(해킹 위험, 개인정보 처리)도 마지막으로 빡세게 테스트하고 문제점 개선해줘. 모든 테스트 과정과 결과는 문서로 남겨주고. (참고: PRD v4.21 전체, TDD v1.8 전체, 디자인 가이드 v3.3 전체)

#### 참고 문서
* Pronto 제품 요구사항 정의서 (PRD) v4.21 (전체)
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (전체)
* Pronto 서비스 디자인 가이드 v3.3 (전체)
* 모든 이전 단계 결과물

---

### 8‑5단계 (기존 7-5): Vercel 배포 및 도메인 연결

#### 목적
개발 완료된 Pronto 서비스를 Vercel 플랫폼을 통해 실제 운영 환경에 배포하고, 구매한 커스텀 도메인을 연결하여 사용자가 공식 주소로 접근할 수 있도록 한다.
#### 결과물
* Vercel 프로젝트 생성 및 Next.js 프로젝트 연동 완료.
* 프로덕션 환경을 위한 환경 변수 설정 완료 (Vercel 대시보드):
    * Supabase API URL 및 Anon/Service Role Key
    * PortOne API Key
    * 카카오/네이버 OAuth 클라이언트 ID 및 시크릿 키
    * 카카오 알림톡 API Key 및 관련 설정 (Make/n8n 웹훅 URL 등)
    * Sentry DSN 및 관련 환경 변수
    * 기타 필요한 모든 API 키 및 비밀 값
* Vercel을 통한 프로덕션 빌드 및 배포 성공.
* (선택 사항) 구매한 커스텀 도메인(예: `www.pronto-service.com`)을 Vercel 프로젝트에 연결하고 DNS 설정 완료.
* 배포된 프로덕션 환경에서 주요 기능(회원가입, 로그인, 예약, 결제, 카카오 알림 등) 최종 테스트 및 정상 동작 확인.
* HTTPS 적용 확인.
* Sentry 연동 및 오류 모니터링 정상 동작 확인.
#### 대표 프롬프트

> 이제 진짜 서비스 오픈 준비하자! Vercel에 우리 Next.js 프로젝트 연결해서 배포하고, Supabase API 키, PortOne 키, 소셜 로그인 키, 카카오 알림톡 관련 키/웹훅 URL, Sentry DSN 같은 운영에 필요한 환경 변수들 Vercel에 다 설정해줘. 배포 성공하면, 우리가 사둔 도메인 (예: www.pronto-service.com) 연결하고 DNS 설정도 마무리해줘. 마지막으로 실제 도메인으로 접속해서 모든 기능이 문제없이 잘 돌아가는지 최종 확인하고 HTTPS 적용됐는지, Sentry 오류 모니터링도 잘 되는지 체크해줘. (참고: TDD v1.8 배포 & 운영, Vercel Documentation, 도메인 등록기관 가이드, Sentry 설정 가이드)

#### 참고 문서
* Pronto 서비스 기술 설계 문서 (TDD) v1.8 (섹션 8: 배포 & 운영)
* Vercel Documentation (프로젝트 생성, 환경 변수 설정, 도메인 연결 가이드)
* 도메인 등록기관(예: 가비아, GoDaddy 등)의 DNS 설정 가이드
* Sentry 설정 및 Next.js 연동 가이드
* 모든 이전 단계 결과물 및 최종 테스트 시나리오

---

### 4‑1단계: 운영자 휴무일 설정 기능 구현

#### [진행상황] holidays 테이블 마이그레이션 SQL 생성 완료. (0016_create_holidays_table.sql)
- service_id, holiday_date, description, created_at, updated_at, UNIQUE(service_id, holiday_date), RLS(admin만 추가/삭제, 모두 조회 가능) 포함
- 다음 단계: 예약 가능 시간 API에서 holidays 테이블을 반영하도록 수정 예정

---
end of document
