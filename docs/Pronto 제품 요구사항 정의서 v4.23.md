# Pronto - 제품 요구사항 정의서 v4.23 (PRD)

**문서 버전:** 4.23 (2025년 5월 13일 업데이트)
**작성일:** 2025년 5월 3일
**작성자:** Gemini
**(변경 이력: v4.23 - 2025년 5월 13일, 기능 요구사항 상세화 및 개발 계획 v8.8 Phase 정보 연동; v4.22 - 2025년 5월 13일, 코드 품질 개선 검토 결과 반영 (NFR 유지보수성, 확장성 항목 보강); v4.21 - 2025년 5월 11일, 시간 선택 자동화 기능 추가 (최초 선택 시 1시간 자동 선택, 최소 1시간 남았을 때 전체 취소 기능); v4.20 - 2025년 5월 10일, 시간 선택 UI UX 상세화 (눈금 위치 및 레이블 형식 변경); v4.19 - 2025년 5월 9일, 예약 연장 기능 및 동시간대 예약 처리 방안 구체화)**

---

## 1. 서비스 정의 및 목표

### 서비스명

**Pronto**

### 서비스 정의

사용자가 **이메일 아이디**로 회원가입 및 로그인 후(초기 버전 기준, **카카오 및 네이버 계정 연동은 Phase 8에서 확장 예정**), 서비스 상세 페이지에서 **리뷰(별점 포함)**를 확인하고 새로운 **시간 범위 슬라이더**를 통해 직관적으로 예약 시간을 30분 단위로 설정하며(최소 1시간 선택 필수), 필요한 정보(기존 정보 자동 완성 지원)를 입력한 뒤, 최소 1시간 예약 후 추가되는 시간에 대해 보유한 사용 가능 시간(적립 시간 + 쿠폰 시간)을 할인에 적용하고 PortOne을 통해 결제를 완료하는 **원페이지 중심의 간편 예약 서비스**입니다.

* 사용자는 **리뷰 작성 시 소정의 시간(10분)을 "적립 시간"**으로 얻을 수 있으며, 마이페이지에서

  * 예약 내역 확인,
  * 예약 변경/취소(정책에 따라),
  * 리뷰 작성/수정/삭제(별점 포함, 완료 건에 한함),
  * 보유 시간(적립/쿠폰) 확인,
  * 로그아웃 및 회원 탈퇴가 가능합니다.
* 운영자는 지정된 이메일과 비밀번호로 로그인하여 **관리 페이지**를 통해

  * 서비스 정보(이미지, 설명, 정책 등),
  * 고객 정보(조회, 추가, 적립/쿠폰 시간 확인 및 쿠폰 부여),
  * 예약 현황, 예약 가능 시간, 휴무일, 리뷰 관리(별점 확인, 숨김/삭제 포함) 등을 수행하고,
  * **대리 예약 및 결제 요청**을 처리하며,
  * 시간 제약 없이 고객 예약을 직접 변경/취소할 수 있습니다.
* 예약 관련 주요 단계(확정, 임박, 변경, 취소, 결제 요청/완료, 리뷰 작성 요청 등)마다 **카카오 알림톡**이 발송됩니다 (실제 카카오 알림톡 발송은 외부 자동화 도구 연동을 통해 Phase 8에서 구현).

### 서비스 목표

1.  **이메일 기반의 간편한 가입·로그인** 환경을 우선 제공하고, 추후 다양한 인증 방식(카카오, 네이버 - Phase 8)으로 확장하여 온라인으로 공간을 예약하고 결제할 수 있는 환경 제공.
2.  운영자가 지정된 이메일 계정으로 안전하게 로그인하여 **효율적으로 예약 및 고객 정보를 관리**하고 서비스를 운영할 수 있는 도구 제공.
3.  **리뷰 작성 기반의 적립과 쿠폰 시스템**을 통해 고객 참여·충성도를 높이고 재방문을 유도.

### 타겟 플랫폼

* **웹** (데스크탑 및 모바일 반응형 지원)

### 주요 기술 스택 (참고)

* Next.js (App Router)
* TypeScript
* Supabase (Auth, DB, Edge Functions)
* PortOne
* 카카오 알림톡 API (Make/n8n 등 외부 자동화 도구 연동 가능)
* 네이버 로그인 API (Phase 8 연동 예정)
* Tailwind CSS

---

## 2. 주요 사용자 및 목표

### 주요 사용자 (End‑User)

* **이메일**로 간편 회원가입/로그인 (Phase 1 완료). (카카오, 네이버 로그인은 Phase 8 지원 예정)
* 이메일 회원가입 시 이메일·비밀번호·이름·휴대폰 번호 입력 후 가입 완료 (Phase 1 완료).
* 이메일 로그인 사용자는 **비밀번호 분실 시 이메일 재설정** (Phase 2 완료).
* **빠르게 예약 가능 시간 확인** 후 온라인 예약/결제 (예약 시간 확인은 Phase 1 완료, 실제 결제는 Phase 7).
* 서비스 상세 페이지에서 **다른 사용자의 리뷰 및 평균 별점** 확인 (Phase 3).
* 기존 고객은 이름·업체명·촬영 목적 자동 완성으로 **예약 절차 간소화** (Phase 3).
* 마이페이지에서 예약 내역 관리 및 정책에 따른 **예약 변경/취소** (기본 DB 처리는 Phase 3, 실제 결제/환불 연동은 Phase 7).
* 이용 완료 후 **리뷰(별점·텍스트 10–100자·이미지 최대 5장) 작성** → 적립 시간 10 분 획득 (Phase 3).
* 작성한 리뷰 **수정·삭제** 가능 (Phase 3).
* 마이페이지에서 **총 적립 시간/쿠폰 시간** 확인 (Phase 3).
* 예약 시 최소 1 시간 결제 후 초과 시간에 대해 **적립/쿠폰 시간으로 할인** (DB 차감은 Phase 4, 실제 결제 반영은 Phase 7).
* **회원 탈퇴** 진행 가능 (Phase 2 완료).
* **카카오톡 알림**(확정, 임박, 변경, 취소, 리뷰 요청 등) 수신 (Phase 8).
* (대리 예약 시) **결제 요청 알림** 수신 후 간편 결제 (결제 요청 알림은 Phase 8, 결제는 Phase 7).

### 운영자 (Operator ‑ 1 인 기준, 'admin' 역할)

* 지정된 운영자 이메일·비밀번호로 로그인 → **운영자 관리 페이지** 접속 (Phase 1 완료).
* 서비스 정보(설명, 가격, 이미지, 정책 등) **최신화** (Phase 1 완료).
* 온라인 **예약·결제 현황 파악**으로 관리 부담 감소 (예약 현황은 Phase 1, 결제 현황은 Phase 7 이후).
* 예약 현황 및 **고객 정보**(가입 방식, 적립/쿠폰 시간) 관리 (Phase 4).
* 특정 고객에게 **30 분 쿠폰** 부여 (Phase 3).
* **리뷰 목록** 확인 및 부적절 리뷰 숨김·삭제 (Phase 4).
* **예약 변경/취소(환불 포함)**를 시간 제한 없이 직접 처리 (DB 처리는 Phase 4, 실제 환불 연동은 Phase 7).
* **공휴일/정기 휴무일** 설정으로 예약 불가 날짜 관리 (Phase 4).
* **오프라인(전화 등) 예약 요청**을 시스템에 등록(대리 예약)하고 결제 요청 (DB 저장은 Phase 4, 결제 요청 알림은 Phase 8, 결제는 Phase 7).
* 신규 예약·결제 완료·고객 변경/취소 등 **알림톡** 수신 (Phase 8).

---

## 2.5 참고 서비스 및 기능 근거

| 항목                                | 참고 서비스                     | 근거                                                                       |
| --------------------------------- | -------------------------- | ------------------------------------------------------------------------ |
| 로그인 방식 (초기: 이메일, 추후: 소셜)      | 다수 온라인 서비스                | 초기 핵심 기능에 집중 후 사용자 편의성 확장을 위해 단계적 도입. 국내 사용률 높은 소셜 로그인을 지원하여 **가입 장벽 감소**. 이메일 가입도 병행해 **선택 폭 확대** |
| 예약 시간 선택 (최소 1 시간 + 30 분 단위)      | 스터디룸·연습실 등 시간 단위 예약 서비스    | 최소 1 시간으로 **운영 효율성** 확보 + 30 분 단위 추가로 **유연성 제공** + 최초 선택 시 1시간 자동 선택으로 **사용자 편의성 향상** |
| 예약 변경/취소 정책 (변경 1 분 전, 취소 31 분 전) | 스페이스클라우드, 에어비앤비 등          | 변경 마감을 **임박 1 분 전**으로 설정해 편의 극대화. 취소는 **예약 31 분 전**으로 설정해 임박 알림 이후 혼란 방지 |
| 리뷰 기반 적립 시간                       | 쿠팡, 무신사 등 리뷰 포인트 제도        | **리뷰 작성을 유도**해 정보 비대칭 해소·재방문 촉진                                          |
| 적립/쿠폰 시간 사용 (최소 1 시간 유료 결제 후)     | 일부 멤버십 최소 결제 조건            | **무분별한 단시간 예약 방지** 및 운영 안정성 확보                                           |

---

## 3. 사용자 경험(UX) 및 주요 플로우

*(이하 플로우 설명은 개발 계획 v8.8의 Phase 정보를 참조하여 각 기능 구현 시점을 고려하여 이해해야 합니다.)*

### 회원가입 플로우 (이메일)

1. 로그인 페이지 **P‑001** → **'이메일로 회원가입'** 클릭
2. 회원가입 페이지 **P‑000**에서 이메일·비밀번호·이름·휴대폰 입력 후 **가입하기**
3. **이메일 인증** 링크 클릭 → 인증 완료
4. 가입 성공 후 곧바로 로그인 상태 또는 로그인 페이지 이동

### 로그인 플로우 (사용자 - 초기 이메일 중심)

1. **P‑001**에서 이메일·비밀번호 입력 후 **로그인** → 이전 페이지 또는 기본 페이지 이동
2. (Phase 8 이후) 로그인 페이지 **P‑001**에서 카카오·네이버·이메일 중 선택
3. (Phase 8 이후) 소셜 로그인은 각 플랫폼 인증 후 리디렉션, 최초 로그인 시 **신규 고객 정보 생성**

### 로그인 플로우 (운영자)

1. **P‑001** 또는 별도 관리자 경로에서 운영자 이메일·비밀번호 입력
2. **admin 역할** 확인 후 **P‑101**(예약 현황)으로 리디렉션

### 비밀번호 찾기/재설정 (이메일 사용자)

1. **'비밀번호 찾기'** 클릭 → **P‑010**에서 이메일 입력
2. 재설정 링크 메일 발송 → 링크 클릭 후 **P‑011**에서 새 비밀번호 설정
3. 변경 완료 → **P‑001**로 이동

### 사용자 예약 플로우 (원페이지)

1. 이메일 로그인(**P‑001**)
2. 서비스 상세 **P‑002**에서 정보·리뷰 확인 후 **캘린더로 날짜를 선택하고, 이후 표시되는 24시간 기준 시간 슬롯(또는 타임라인)에서** 원하는 예약 시간을 선택합니다.
   * 시간 슬롯은 기본적으로 **00:00부터 23:30까지 30분 단위**로 전체가 표시됩니다.
   * UI 상단에는 **각 시간 슬롯의 시작 경계를 나타내는 눈금**이 있으며:
     * **정각 시간(HH:00)에는 상대적으로 굵은 세로 눈금**과 함께 **'HH:00' 형식의 24시간제 시간 레이블**이 표시됩니다.
     * **30분 시간(HH:30)에는 더 얇은 세로 눈금**과 함께 **'HH:30' 형식의 24시간제 시간 레이블**이 표시됩니다.
   * 각 30분 슬롯 박스는 연속된 두 눈금 사이의 영역을 차지하며, **슬롯 내부에는 별도의 시간 텍스트가 표시되지 않습니다**.
   * 사용자는 이 중에서 **해당 서비스의 실제 운영 시간 내에 있고, 다른 예약 등으로 인해 마감되지 않은 슬롯**을 선택할 수 있습니다. 운영 시간 외 슬롯이나 이미 마감된 슬롯은 시각적으로 비활성화되어 선택할 수 없습니다.
   * 최소 1시간 이상 선택해야 하며, 최대 24시간까지 선택 가능합니다.
   * (선택적 추가) 현재 Pronto 서비스는 06:00부터 24:00(익일 00:00)까지 운영되므로, 이 시간 외의 슬롯은 비활성화되어 표시됩니다.
3. **'예약하기'** 클릭 → 동일 페이지 하단 입력 영역 확장

   * 기존 고객: 이름·업체명·촬영 목적 **자동 완성** (Phase 3)
   * 차량번호, 개인정보 동의, 요청사항 입력 (Phase 3)
   * **보유 적립/쿠폰 시간** 확인 (Phase 3)
4. **사용 시간 적용(선택)** (Phase 4에서 DB 차감, Phase 7에서 실제 결제 반영)

   * 총 예약 시간이 1시간 초과 시 초과분에 대해 **쿠폰 → 적립 순** 할인 시간 선택
   * 시스템이 **최종 결제 금액** 계산·표시
5. **'예약 완료 및 결제하기'** → **P‑006**에서 PortOne 결제 (Phase 7)
6. **P‑007** 결과 확인

   * 성공: **예약 확정 카카오 알림톡** (Make/n8n 등 외부 연동 - Phase 8)
   * 실패/이탈: 안내 후 **P‑002**로 이동

### 마이페이지 플로우

1. **P‑005** 접속 → 계정 정보·적립/쿠폰 시간·예약 내역 확인 (기본 예약 내역은 Phase 1, 상세 필터링은 Phase 3)
2. 예약 상세 →

   * **'리뷰 작성'**(**P‑009**) (Phase 3)
   * **'예약 변경'**(**P‑008**, 시작 1 분 전까지) (DB 처리는 Phase 3, 차액 결제/환불은 Phase 7)
   * **'예약 취소'**(시작 31 분 전까지) (DB 처리는 Phase 3, 실제 환불은 Phase 7)
3. **리뷰 수정/삭제** (Phase 3), **회원 탈퇴** (Phase 2), **로그아웃** (Phase 1) 가능

### 리뷰 작성/수정

1. **P‑005**에서 **'리뷰 작성'** 또는 **'리뷰 수정'**
2. **P‑009**에서 별점(1‑5), 텍스트(10‑100자), 이미지(≤5장) 입력
3. **'리뷰 등록/수정 완료'** →

   * 신규 등록 시 **적립 시간 10 분 자동 부여** (Phase 3)
   * 수정 시 적립 시간 변동 없음

### 운영자 관리 플로우

| 기능    | 위치            | 내용                                                     | 개발 계획 Phase |
| ----- | ------------- | ------------------------------------------------------ | ----------- |
| 정보 관리 | **P‑106** | 서비스 정보(텍스트·이미지·정책) 수정                                  | Phase 1     |
| 예약 설정 | **P‑102** | 예약 가능 시간, 공휴일/휴무일 설정                                   | Phase 4     |
| 예약 확인 | **P‑101** | 예약 목록·상세(결제·요청사항·변경 이력·메모) 확인, **직접 변경/취소** 가능         | Phase 1 (기본), Phase 4 (변경/취소 DB), Phase 7 (환불) |
| 고객 관리 | **P‑103/104** | 고객 목록(가입 방식·적립/쿠폰) 조회, 신규 등록, **쿠폰 30 분 부여** | Phase 3, 4  |
| 리뷰 관리 | **P‑107** | 리뷰 목록(별점) 확인, **숨김/삭제** | Phase 4     |
| 대리 예약 | **P‑101/105** | 고객 선택/등록 → 날짜·시간 선택 → 메모 입력 → 예약 생성 → **결제 요청 카카오 알림톡** 발송 | Phase 4 (DB 저장), Phase 8 (알림), Phase 7 (결제) |
| 알림 수신 | –             | 신규 예약·결제 완료·고객 변경/취소 등 **카카오톡 알림** | Phase 8     |

---

## 4. 기능 요구사항 (Functional Requirements)

### 사용자 인증 (F‑AUTH)

* **F‑AUTH‑001**: 사용자는 로그인 페이지(P‑001)에서 **이메일**을 통해 로그인할 수 있다. (Phase 1 완료)
* **F‑AUTH‑002**: (Phase 8) (카카오 로그인) 사용자는 카카오 로그인 버튼을 통해 카카오 계정으로 서비스에 로그인할 수 있다. (최초 로그인 시 사용자 정보(이름, 이메일 등)를 기반으로 `customers` 테이블에 신규 레코드 생성 또는 기존 카카오 로그인 이력 확인 후 로그인 처리)
* **F‑AUTH‑003**: (Phase 8) (네이버 로그인) 사용자는 네이버 로그인 버튼을 통해 네이버 계정으로 서비스에 로그인할 수 있다. (최초 로그인 시 사용자 정보(이름, 이메일, 휴대폰 번호 등)를 기반으로 `customers` 테이블에 신규 레코드 생성 또는 기존 네이버 로그인 이력 확인 후 로그인 처리)
* **F‑AUTH‑004**: (이메일 로그인 – 고객) 일반 고객은 이메일 주소와 비밀번호를 입력하여 서비스에 로그인할 수 있다. (Phase 1 완료)
* **F‑AUTH‑005**: (이메일 로그인 – 운영자) 운영자는 지정된 이메일 주소와 비밀번호를 입력하여 서비스에 로그인할 수 있다. (Phase 1 완료)
* **F‑AUTH‑006**: (이메일 회원가입 시작) 사용자는 로그인 페이지(P‑001)에서 **'이메일로 회원가입'** 링크를 통해 회원가입 페이지(P‑000)로 이동할 수 있다. (Phase 1 완료)
* **F‑AUTH‑007**: (이메일 회원가입 정보 입력) 사용자는 회원가입 페이지(P‑000)에서 이메일 주소, 비밀번호, 비밀번호 확인, 이름, 휴대폰 번호를 입력한다. (Phase 1 완료)
* **F‑AUTH‑008**: (이메일 회원가입 유효성 검사) 시스템은 이메일 형식, 비밀번호 복잡도(8자 이상, 영문/숫자/특수문자 조합), 이름(필수), 휴대폰 번호 형식(하이픈 제외 숫자)를 검증한다. 이미 가입된 이메일 또는 휴대폰 번호인 경우 오류를 표시한다. (Phase 1 완료)
* **F‑AUTH‑009**: (이메일 회원가입 비밀번호 처리) 시스템은 사용자가 입력한 비밀번호를 안전한 방식(예: bcrypt)으로 해싱하여 저장한다. (Phase 1 완료)
* **F‑AUTH‑010**: (이메일 인증) 회원가입 정보 입력 및 유효성 검사 통과 시, 시스템은 입력된 이메일 주소로 인증 메일을 발송한다. 사용자는 메일 내 인증 링크를 클릭하여 가입을 완료해야 한다. (Phase 1 완료)
* **F‑AUTH‑011**: (비밀번호 찾기 시작) 이메일 로그인 사용자는 로그인 페이지(P‑001)에서 **'비밀번호 찾기'** 링크를 통해 비밀번호 찾기 페이지(P‑010)로 이동할 수 있다. (Phase 2 완료)
* **F‑AUTH‑012**: (비밀번호 재설정 링크 요청) 사용자는 비밀번호 찾기 페이지(P‑010)에서 가입 시 사용한 이메일 주소를 입력하고 재설정 링크 발송을 요청한다. (Phase 2 완료)
* **F‑AUTH‑013**: (비밀번호 재설정 링크 발송) 시스템은 해당 이메일 주소가 가입된 계정인지 확인 후, 유효 시간이 제한된 비밀번호 재설정 링크를 이메일로 발송한다. (Phase 2 완료)
* **F‑AUTH‑014**: (비밀번호 재설정) 사용자는 이메일의 링크를 통해 비밀번호 재설정 페이지(P‑011)로 이동하여 새 비밀번호를 설정한다. (새 비밀번호 유효성 검사 및 해싱 적용) (Phase 2 완료)
* **F‑AUTH‑015**: (로그인 상태 유지) 시스템은 사용자가 로그인 상태를 유지할 수 있도록 세션 또는 토큰 기반 인증을 사용한다. (Phase 1 완료)
* **F‑AUTH‑016**: (로그인 필요 시 리디렉션) 시스템은 로그인이 필요한 기능 접근 시 로그인 여부를 확인하고, 비로그인 상태면 로그인 페이지(P‑001)로 리디렉션 후 이전 페이지로 복귀시킨다. (단, 마이페이지 버튼 클릭으로 로그인 페이지 이동 후 로그인 성공 시에는 마이페이지로 이동) (Phase 1 완료)
* **F‑AUTH‑017**: (로그인 성공 시 리디렉션) 시스템은 로그인 성공 후 역할(고객/운영자)을 확인하여 고객 → 이전 페이지 또는 기본 페이지(P‑002) (단, 마이페이지 버튼 클릭으로 로그인한 경우 마이페이지(P-005)로 이동), 운영자 → 관리자 대시보드(P‑101)로 리디렉션한다. (Phase 1 완료)
* **F‑AUTH‑018**: (로그아웃) 사용자는 마이페이지(P‑005) 또는 헤더 등 공통 영역에서 로그아웃할 수 있다. (Phase 1 완료)
* **F‑AUTH‑019**: (회원 탈퇴 시작) 사용자는 마이페이지(P‑005)에서 **'회원 탈퇴'** 버튼으로 탈퇴 절차를 시작할 수 있다. (Phase 2 완료)
* **F‑AUTH‑020**: (회원 탈퇴 확인) 시스템은 탈퇴 시 유의사항(예약 내역 접근 불가, 적립/쿠폰 소멸, 재가입 제한 등)을 안내하고 최종 의사를 확인한다. (Phase 2 완료)
* **F‑AUTH‑021**: (회원 탈퇴 처리) 최종 탈퇴 확인 시 계정을 **즉시 비활성화**(is_active =false) 처리하고, 30 일 유예 후 개인 식별 정보를 익명화한다. 예약/리뷰 등은 익명 ID로 보존. (Phase 2 완료)

---

### 서비스 정보 조회 (F‑INFO)

* **F‑INFO‑001**: 사용자는 서비스 상세 페이지(P‑002)에서 서비스 이름, 설명, 가격, 위치 정보, 대표 이미지를 볼 수 있다. (Phase 1 완료)
* **F‑INFO‑002**: 서비스 상세 페이지의 **캘린더 UI**로 예약 가능한 날짜를 시각적으로 확인할 수 있다. (휴무일·예약 불가 날짜는 비활성화) (Phase 1 완료)
* **F‑INFO‑003**: 날짜 선택 시, 해당 날짜에 대해 **00:00부터 23:30까지의 30분 단위 시간 슬롯들이 기본적으로 모두 표시**됩니다. UI 상단에는 **각 시간 슬롯의 시작 경계에 맞춰진 눈금과 시간 레이블**이 표시되며, 정각 시간에는 **굵은 세로 눈금과 'HH:00' 형식의 24시간제 레이블**, 30분 시간에는 **얇은 세로 눈금과 'HH:30' 형식의 24시간제 레이블**이, 각 슬롯 박스는 연속된 두 눈금 사이의 공간을 차지하고 **내부에는 시간 텍스트를 표시하지 않습니다**. 시스템은 API로부터 해당 서비스의 실제 운영 시간(`operatingStartTime`, `operatingEndTime`) 및 이미 예약되었거나 차단된 시간(`unavailableSlots`) 정보를 받아와, 운영 시간 외의 슬롯 및 예약 불가능한 슬롯들을 시각적으로 비활성화하여 사용자가 선택할 수 없도록 처리합니다. (Phase 1 완료, 시간 선택 자동화 기능은 Phase 5)
* **F‑INFO‑004**: 다른 사용자의 **리뷰 목록**(작성자 아이콘, 마스킹 이름, 작성일, 별점, 리뷰 텍스트 일부/전체, 이미지 일부/전체)을 조회할 수 있다. (최신순 기본) (Phase 3)
* **F‑INFO‑005**: 해당 서비스의 **평균 별점**과 **총 리뷰 수**를 확인할 수 있다. (Phase 3)

---

### 예약 신청 및 결제 (F‑RESV)

* **F‑RESV‑001**: 사용자는 서비스 상세 페이지(P‑002)에서 날짜를 선택할 수 있다. (Phase 1 완료)
* **F‑RESV‑002**: 사용자는 선택된 날짜에 대해 **시간 범위 슬라이더(또는 시간 슬롯 피커)**를 이용하여 예약 시작 시간과 종료 시간을 30분 단위로 설정할 수 있다. (Phase 1 완료, UI 개선은 Phase 5)
* **F‑RESV‑003**: 시스템은 사용자가 최소 1시간 이상 예약하도록 강제한다. (Phase 1 완료)
* **F‑RESV‑004**: 시스템은 예약 불가능한 시간대(이미 예약된 시간, 휴무일, 운영 시간 외)를 슬라이더 또는 슬롯 피커 상에 시각적으로 표시하고 선택할 수 없도록 한다. (Phase 1 완료)
* **F‑RESV‑005**: 사용자는 예약 시작 1분 전까지만 예약을 신청할 수 있다. (Phase 1 완료)
* **F‑RESV‑006**: 사용자가 '예약하기' 버튼을 클릭하면, 시스템은 사용자 로그인 여부를 확인하고, 비로그인 시 로그인 페이지(P‑001)로 안내한다. (Phase 1 완료)
* **F‑RESV‑007**: 로그인된 사용자가 '예약하기' 버튼을 클릭하면, 동일 페이지 하단에 예약 정보 입력 영역(Booking Form)이 확장되어 표시된다. (Phase 1 완료)
* **F‑RESV‑008**: 기존 예약 이력이 있는 고객의 경우, 시스템은 이름, 업체명, 촬영 목적 필드를 가장 최근 예약 정보로 자동 완성하여 제공한다. (Phase 3)
* **F‑RESV‑009**: 사용자는 예약 폼에서 차량번호(선택 사항), 개인정보 수집 및 이용 동의(필수), 기타 요청사항을 입력할 수 있다. (Phase 3)
* **F‑RESV‑010**: 사용자는 예약 폼에서 자신이 보유한 적립 시간 및 쿠폰 시간 현황을 확인할 수 있다. (Phase 3)
* **F‑RESV‑011**: 총 예약 시간이 1시간을 초과하는 경우, 사용자는 초과된 예약 시간에 대해 보유한 쿠폰 시간 또는 적립 시간을 사용하여 할인을 적용할 수 있다. (쿠폰 우선 차감) (DB 차감은 Phase 4, 실제 결제 반영은 Phase 7)
* **F‑RESV‑012**: 시스템은 사용자의 할인 시간 선택에 따라 최종 결제 예정 금액을 실시간으로 계산하여 표시한다. (Phase 4)
* **F‑RESV‑013**: 사용자는 예약 요약 정보(선택 시간, 총 금액, 할인 적용 금액, 최종 결제 금액) 및 서비스 이용 약관을 확인한다. (Phase 1 완료, 할인 관련 표시는 Phase 4)
* **F‑RESV‑014**: 사용자가 '예약 완료 및 결제하기' 버튼을 클릭하면, 시스템은 결제 페이지(P‑006)로 이동시킨다. (Phase 1 완료)
* **F‑RESV‑015**: 사용자는 결제 페이지(P‑006)에서 PortOne 결제 모듈을 통해 신용카드 등으로 결제를 진행한다. (Phase 7)
* **F‑RESV‑016**: 결제 성공 시, 시스템은 `reservations` 테이블에 해당 예약 정보를 `status='confirmed'`로 저장하고, 사용된 적립/쿠폰 시간을 차감하며, 결제 완료 페이지(P‑007)로 리디렉션한다. 실패 또는 이탈 시 사용자에게 안내 후 서비스 상세 페이지(P‑002)로 이동시킨다. (DB 저장은 Phase 1 완료, 시간 차감은 Phase 4, 실제 결제 연동 및 확정은 Phase 7)
* **F-RESV-017**: (고객 예약 이용 중 연장) 고객은 서비스 이용 중 또는 이용 종료 직후 정의된 유예 시간(Grace Period, 예: 10분) 이내에, 다음 시간대에 예약이 없을 경우 현재 예약에 이어서 30분 단위로 시간을 연장하고 추가 요금을 결제할 수 있다. (DB 처리는 Phase 5, 실제 결제는 Phase 7)
* **F-RESV-018**: (동시 예약 시도 처리 및 중복 방지) 동일 시간대에 여러 사용자가 동시에 예약을 시도할 경우, 시스템은 PortOne 결제 완료 및 DB 예약 확정 트랜잭션이 가장 먼저 성공한 사용자에게 해당 시간 슬롯을 배정한다. 예약에 실패한 사용자에게는 즉시 안내하고 결제된 금액을 자동 환불 처리한다. (DB 제약은 Phase 5, 실제 결제/환불 연동은 Phase 7)

---

### 예약 변경 (F‑MGMT‑M)

* **F‑MGMT‑M‑001**: 사용자는 마이페이지(P‑005)의 예약 내역에서 예약 시작 1분 전까지 예약을 변경할 수 있다.
* **F‑MGMT‑M‑002**: 예약 변경 시 횟수 제한은 없다.
* **F‑MGMT‑M‑003**: 사용자가 '예약 변경' 버튼을 클릭하면, 예약 변경 페이지/모달(P‑008)로 이동하여 새로운 날짜 및 시간을 선택할 수 있다. (UI는 P‑002와 유사)
* **F‑MGMT‑M‑004**: 시스템은 사용자가 선택한 새로운 예약 시간에 대해 실시간으로 예약 가능 여부를 확인하여 안내한다.
* **F‑MGMT‑M‑005**: 사용자가 변경 사항을 확정하면, 시스템은 `reservations` 테이블의 해당 예약 정보를 업데이트하고 `status`를 'modified'로 변경한다. (DB 처리는 Phase 3)
* **F‑MGMT‑M‑006**: 예약 시간 변경으로 인해 요금 변동(추가 결제 또는 부분 환불)이 발생하는 경우, 시스템은 사용자에게 변경된 요금 정보를 안내한다. (안내는 Phase 3, 실제 추가 결제/부분 환불 처리는 Phase 7)
* **F‑MGMT‑M‑007**: 예약 변경 완료 시, 시스템은 사용자에게 카카오 알림톡으로 변경 내용을 발송한다. (Phase 8)
* **F‑MGMT‑M‑008**: 운영자도 관리 페이지(P‑101)에서 시간 제약 없이 고객 예약을 변경할 수 있다. (DB 처리는 Phase 4, 차액 결제/환불은 Phase 7, 알림은 Phase 8)

---

### 예약 취소/환불 (F‑MGMT‑C)

* **F‑MGMT‑C‑001**: 사용자는 마이페이지(P‑005)의 예약 내역에서 예약 시작 31분 전까지 예약을 취소할 수 있다.
* **F‑MGMT‑C‑002**: 예약 시작 31분 전까지 취소 시 결제 금액의 100%를 환불받는다. 그 이후에는 취소 및 환불이 불가능하다.
* **F‑MGMT‑C‑003**: 사용자가 '예약 취소' 버튼을 클릭하고 최종 확인하면, 시스템은 `reservations` 테이블의 해당 예약 상태를 `status='cancelled'`로 변경하고, PortOne 환불 API를 호출하여 결제 금액을 환불 처리한다. (DB 처리는 Phase 3, 실제 환불 연동은 Phase 7)
* **F‑MGMT‑C‑004**: 예약 취소 및 환불 완료 시, 시스템은 사용자에게 카카오 알림톡으로 처리 결과를 발송한다. (Phase 8)
* **F‑MGMT‑C‑005**: 운영자도 관리 페이지(P‑101)에서 시간 제약 없이 고객 예약을 취소하고 환불 처리할 수 있다. (DB 처리는 Phase 4, 실제 환불 연동은 Phase 7, 알림은 Phase 8)

---

### 리뷰 관리 (F‑MGMT‑R)

* **F‑MGMT‑R‑001**: 이용이 완료된 예약 건에 대해서만 리뷰를 작성할 수 있다.
* **F‑MGMT‑R‑002**: 사용자는 마이페이지(P‑005) 또는 서비스 상세 페이지(P‑002)의 해당 예약 내역에서 '리뷰 작성' 버튼을 통해 리뷰 작성 페이지/모달(P‑009)로 이동할 수 있다.
* **F‑MGMT‑R‑003**: 사용자는 리뷰 작성 시 별점(1~5점, 필수), 텍스트(10~100자), 이미지(최대 5장, 선택 사항)를 등록할 수 있다.
* **F‑MGMT‑R‑004**: 등록된 리뷰는 `reviews` 테이블에 저장되며, 서비스 상세 페이지(P‑002)의 후기 탭에 노출된다.
* **F‑MGMT‑R‑005**: 리뷰 목록은 최신순으로 정렬되며, 페이지네이션 또는 '더보기' 기능을 통해 추가 리뷰를 로드할 수 있다.
* **F‑MGMT‑R‑006**: 리뷰 목록에 표시되는 작성자 이름은 개인정보 보호를 위해 마스킹 처리된다 (예: 김\*\*).
* **F‑MGMT‑R‑007**: 리뷰 텍스트가 길 경우 일부만 표시하고 '펼쳐보기' 기능을 제공하며, 이미지는 썸네일 형태로 표시하고 클릭 시 원본 크기로 볼 수 있도록 한다.
* **F‑MGMT‑R‑008**: 사용자는 마이페이지(P‑005) '내 리뷰' 탭에서 자신이 작성한 리뷰 목록을 확인하고, 각 리뷰를 수정하거나 삭제할 수 있다.
* **F‑MGMT‑R‑009**: 리뷰 수정 시 기존 작성 내용을 불러와 수정할 수 있으며, 이미지 변경도 가능하다.
* **F‑MGMT‑R‑010**: 리뷰 삭제 시 사용자에게 최종 확인 후 DB에서 해당 리뷰를 논리적 또는 물리적으로 삭제한다.
* **F‑MGMT‑R‑011**: 운영자는 관리 페이지(P‑107)에서 전체 리뷰 목록을 확인하고, 부적절한 리뷰에 대해 숨김 또는 삭제 처리를 할 수 있다.
* **F‑MGMT‑R‑012**: 시스템은 서비스 이용 완료 다음 날, 해당 고객에게 리뷰 작성을 요청하는 카카오 알림톡을 발송한다. (Phase 8)
*(위 기능들은 Phase 3, 4에서 구현)*

---

### 적립/쿠폰 시간 시스템 (F‑TIME)

* **F‑TIME‑001**: (삭제됨 - F-MGMT-R-003으로 통합)
* **F‑TIME‑002**: (삭제됨 - F-MGMT-R-003으로 통합)
* **F‑TIME‑003**: 운영자는 관리 페이지(P‑103)에서 특정 고객에게 30분 단위의 쿠폰 시간을 부여할 수 있다.
* **F‑TIME‑004**: 부여된 쿠폰은 `customer_coupons` 테이블에 저장되며, 유효 기간(예: 발급일로부터 3개월)을 가질 수 있다 (오픈 이슈).
* **F‑TIME‑005**: 사용자는 예약 시(F‑RESV‑011), 총 예약 시간이 1시간을 초과하는 경우 초과 시간에 대해 보유한 쿠폰 시간 또는 적립 시간을 사용하여 요금을 할인받을 수 있다.
* **F‑TIME‑006**: 할인 적용 시 쿠폰 시간이 적립 시간보다 우선적으로 차감된다. 사용되는 시간은 30분 단위로 선택 가능하다.
* **F‑TIME‑007**: 예약 확정 또는 결제 완료 시, 사용된 쿠폰은 `customer_coupons` 테이블에서 '사용됨' 상태로 변경되고, 사용된 적립 시간은 `customers` 테이블의 `accumulated_time_minutes`에서 차감된다. (DB 차감은 Phase 4, 실제 결제 반영은 Phase 7)
* **F‑TIME‑008**: 사용자는 마이페이지(P‑005)에서 현재 보유한 총 적립 시간과 사용 가능한 쿠폰 목록(개수, 만료일 등)을 확인할 수 있다.
* **F‑TIME‑009**: 운영자는 고객 관리 페이지(P‑103)에서 각 고객의 적립 시간 및 쿠폰 보유 현황을 확인할 수 있다.
* **F‑TIME‑010**: 사용자가 리뷰를 성공적으로 등록하면(F‑MGMT‑R‑003), 시스템은 해당 사용자에게 10분의 적립 시간을 자동으로 부여한다 (`customers` 테이블 업데이트). (Phase 3)

---

### 예약/계정 관리 – 운영자 (F‑MGMT‑O)

* **F‑MGMT‑O‑001**: 운영자는 서비스 예약 설정 페이지(P‑102)를 통해 서비스 운영 시간(시작 시간, 종료 시간)을 설정할 수 있다. (Phase 4)
* **F‑MGMT‑O‑002**: 운영자는 서비스 예약 설정 페이지(P‑102)를 통해 휴무일(특정 날짜 또는 반복 요일)을 설정할 수 있다. (Phase 4)
* **F‑MGMT‑O‑003**: 운영자는 관리 페이지(P‑101)에서 전체 예약 목록(고객명, 서비스명, 예약일시, 상태, 결제금액 등)을 조회하고 필터링(날짜, 상태 등)할 수 있다. (Phase 1 완료, 필터링은 Phase 6 대시보드 개선 시 포함 가능)
* **F‑MGMT‑O‑004**: 운영자는 각 예약 건의 상세 정보(요청사항, 운영자 메모 등)를 확인할 수 있다. (Phase 1 완료)
* **F‑MGMT‑O‑005**: 운영자는 고객 관리 페이지(P‑103)에서 전체 고객 목록(이름, 연락처, 가입 방식, 적립/쿠폰 시간 요약 등)을 조회하고 검색할 수 있다. (Phase 4)
* **F‑MGMT‑O‑006**: 운영자는 고객 관리 페이지에서 신규 고객 정보를 수동으로 등록할 수 있다 (P‑104). (Phase 4)
* **F‑MGMT‑O‑007**: 운영자는 특정 고객에게 30분 단위의 쿠폰 시간을 부여할 수 있다 (F‑TIME‑003). (Phase 3)
* **F‑MGMT‑O‑008**: 운영자는 전화 등으로 예약 요청을 받은 경우, 대리 예약 페이지(P‑105)를 통해 고객 대신 예약을 생성할 수 있다. (Phase 4)
* **F‑MGMT‑O‑009**: 대리 예약 시 운영자는 고객 정보를 검색하거나 신규로 입력하고, 예약 날짜/시간을 선택하며, 내부 관리용 메모를 남길 수 있다. (Phase 4)
* **F‑MGMT‑O‑010**: 대리 예약은 `status='pending_payment'` 상태로 생성되며, 시스템은 해당 고객에게 결제 요청 카카오 알림톡을 발송한다. (DB 저장은 Phase 4, 알림은 Phase 8)
* **F‑MGMT‑O‑011**: 고객이 대리 예약 건에 대해 결제를 완료하면, 해당 예약의 상태는 `confirmed`로 변경된다. (Phase 7)
* **F‑MGMT‑O‑012**: 운영자는 시간 제약 없이 고객 예약을 직접 변경하거나 취소(환불 포함)할 수 있다. (DB 처리는 Phase 4, 실제 환불/차액 결제는 Phase 7)

---

### 서비스 정보 관리 (F‑MGMT‑B)

* **F‑MGMT‑B‑001**: 운영자는 관리 페이지(P‑106)에서 서비스의 기본 정보(이름, 설명, 시간당 가격, 위치 등)를 수정할 수 있다. (Phase 1 완료)
* **F‑MGMT‑B‑002**: 운영자는 서비스 대표 이미지 및 추가 이미지를 업로드하고 관리할 수 있다. (Phase 1 완료)
* **F‑MGMT‑B‑003**: 운영자는 서비스 이용 약관, 개인정보 처리 방침 등의 정책 내용을 Markdown 형식으로 편집하고 게시할 수 있다. (Phase 6 FAQ 구현 시 함께 고려)

---

### 결제 처리 – 대리 예약 (F‑PYMT)

* **F‑PYMT‑001**: 고객이 대리 예약(F‑MGMT‑O‑010)에 대한 결제 요청 카카오 알림톡 내 링크를 통해 결제를 완료하면, PortOne으로부터 결제 성공 웹훅이 시스템으로 전송된다. (Phase 7)
* **F‑PYMT‑002**: 시스템은 수신된 웹훅을 검증하고, 해당 대리 예약 건의 상태를 `confirmed`로 업데이트하며, 관련 결제 정보를 저장한다. (Phase 7)

---

### 알림 (F‑NOTI)

* **F‑NOTI‑001**: (예약 확정 알림) 시스템은 예약(결제)이 최종 확정되면 고객 및 운영자에게 카카오 알림톡으로 예약 확정 내용을 발송한다. (Make/n8n 등 외부 자동화 도구 연동을 통해 Phase 8에서 구현)
* **F‑NOTI‑002**: (예약 임박 알림 - 1시간 전) 시스템은 예약 시작 1시간 전에 고객에게 카카오 알림톡으로 예약 임박 알림을 발송한다. (Phase 8)
* **F‑NOTI‑003**: (예약 변경 완료 알림) 시스템은 예약 변경이 완료되면 고객에게 카카오 알림톡으로 변경된 내용을 발송한다. (Phase 8)
* **F‑NOTI‑004**: (예약 취소 및 환불 완료 알림) 시스템은 예약 취소 및 환불 처리가 완료되면 고객에게 카카오 알림톡으로 결과를 발송한다. (Phase 8)
* **F‑NOTI‑005**: (대리 예약 결제 요청 알림) 운영자가 대리 예약을 생성하면, 시스템은 해당 고객에게 결제를 요청하는 카카오 알림톡(결제 페이지 링크 포함)을 발송한다. (Phase 8)
* **F‑NOTI‑006**: (예약 만료 임박 및 연장 안내 알림 - 15분 전) 시스템은 예약 종료 15분 전에 고객에게 퇴실 준비 및 연장 가능 여부를 포함한 카카오 알림톡을 발송한다. (Phase 8)
* **F‑NOTI‑007**: (예약 연장 완료 알림) 고객이 예약을 성공적으로 연장하고 추가 결제를 완료하면, 시스템은 고객에게 연장 완료 카카오 알림톡을 발송한다. (Phase 8)
* **F‑NOTI‑008**: (동시 예약 실패 및 자동 환불 안내 알림) 동시 예약 시도로 인해 예약에 실패하고 자동 환불 처리된 경우, 시스템은 해당 사용자에게 상황을 안내하는 카카오 알림톡을 발송한다. (Phase 8)
* **F‑NOTI‑009**: (운영자 알림) 신규 예약, 예약 변경/취소, 결제 완료 등 주요 이벤트 발생 시 운영자에게도 카카오 알림톡으로 관련 내용을 발송한다. (Phase 8)
* **F‑NOTI‑010**: (적립 시간 부여 알림 - 선택 사항) 리뷰 작성 등으로 적립 시간이 부여되었을 때 고객에게 카카오 알림톡으로 안내한다. (Phase 8)
* **F‑NOTI‑011**: (리뷰 작성 요청 알림) 시스템은 서비스 이용 완료 다음 날, 해당 고객에게 리뷰 작성을 요청하는 카카오 알림톡을 발송한다. (Phase 8)

---

### 오류 처리 (F‑ERR)

* **F‑ERR‑001**: 결제 실패·중복 예약·서버 오류 등 주요 예외 발생 시 **명확한 오류 메시지** 표시 및 적절한 리다이렉션 (전체 Phase에 걸쳐 지속적으로 구현)

---

## 5. 비기능 요구사항 (Non‑Functional Requirements)

### 사용성 & 국제화 (NF‑USAB & I18N)

* **NF‑USAB‑001**: 모든 페이지는 반응형 웹 디자인을 적용하여 다양한 기기(데스크탑, 태블릿, 모바일)에서 최적화된 화면을 제공한다.
* **NF‑USAB‑002**: 사용자는 최소한의 단계와 노력으로 핵심 기능(예약, 결제, 정보 확인)을 완료할 수 있도록 직관적인 UI/UX를 제공한다.
* **NF‑USAB‑003**: 시스템은 명확하고 일관된 용어, 아이콘, 레이아웃을 사용하여 사용자의 학습 부담을 줄인다.
* **NF‑USAB‑004**: 날짜 및 시간 표시는 한국 표준시(KST)를 기준으로 하며, 데이터 저장 시에는 UTC를 우선 고려한다.
* **NF‑USAB‑005**: 웹 접근성 표준(WCAG 2.1 AA 레벨 목표)을 준수하여 모든 사용자가 서비스 이용에 불편함이 없도록 노력한다.

### 성능 (NF‑PERF)

* **NF‑PERF‑001**: 주요 페이지(서비스 상세, 마이페이지 등)의 평균 로딩 시간은 3초 이내를 목표로 한다.
* **NF‑PERF‑002**: 주요 API(예약 가능 시간 조회, 예약 확정 등)의 평균 응답 시간은 1초 이내를 목표로 한다.
* **NF‑PERF‑003**: 예약 가능 시간 조회 및 리뷰 목록 조회 등 데이터가 많은 기능에 대해 성능 최적화를 고려한다 (예: 페이지네이션, DB 인덱싱, 캐싱).

### 보안 (NF‑SECU)

* **NF‑SECU‑000**: (Phase 8) 카카오/네이버 로그인 시 OAuth 2.0 프로토콜을 준수하여 안전한 인증을 제공한다.
* **NF‑SECU‑001**: 모든 민감 정보(API 키, DB 접속 정보, 비밀번호 등)는 환경 변수를 통해 안전하게 관리하며 코드에 직접 노출하지 않는다.
* **NF‑SECU‑002**: 시스템은 사용자의 신용카드 정보를 직접 저장하거나 처리하지 않고, PortOne과 같은 PG사 모듈을 통해 안전하게 결제를 처리한다.
* **NF‑SECU‑003**: 사용자 입력값에 대해 XSS(Cross-Site Scripting), SQL Injection 등의 공격을 방지하기 위해 적절한 입력 검증(Sanitization) 및 이스케이프 처리를 수행한다.
* **NF‑SECU‑004**: Supabase의 RLS(Row Level Security) 정책을 적극 활용하여 사용자 역할 및 데이터 소유권에 따른 접근 제어를 강화한다.
* **NF‑SECU‑005**: 이미지 등 파일 업로드 시 파일 타입 및 크기 제한을 적용하고, 악성 파일 업로드 가능성을 최소화한다.
* **NF‑SECU‑006**: 사용자 비밀번호는 Supabase Auth의 안전한 해싱 메커니즘을 통해 저장한다.
* **NF‑SECU‑007**: 회원 탈퇴 시 개인 식별 정보는 유예 기간 후 익명화 처리하여 개인정보를 보호한다.
* **NF‑SECU‑008**: HTTPS를 통해 모든 통신을 암호화한다.
* **NF‑SECU‑009**: 웹훅 수신 시 서명 검증 등을 통해 요청의 유효성을 확인한다.

### **유지보수성 (NF‑MAINT)** (업데이트)

* **NF‑MAINT‑001**: 코드는 명확하고 이해하기 쉬운 스타일로 작성되어야 하며, 적절한 주석을 포함하여 다른 개발자가 쉽게 이해하고 수정할 수 있도록 한다.
* **NF‑MAINT‑002**: 중복 코드를 최소화하고, 재사용 가능한 로직은 모듈화된 함수 또는 컴포넌트로 분리하여 관리한다.
* **NF‑MAINT‑003**: 하드코딩된 설정값(API 경로, 운영 시간, UI 텍스트 등)을 최소화하고, 환경 변수, 중앙 설정 파일, 또는 상수 파일을 통해 관리하여 변경 용이성을 높인다.
* **NF‑MAINT‑004**: 컴포넌트는 단일 책임 원칙을 따르도록 설계하고, 기능별로 명확하게 분리하여 응집도를 높이고 결합도를 낮춘다.
* **NF‑MAINT‑005**: 단위 테스트 및 통합 테스트를 통해 코드 변경 시 안정성을 확보하고, 회귀 테스트를 용이하게 한다. (테스트 코드 작성은 별도 계획)

### **확장성 (NF‑EXTN)** (업데이트)

* **NF‑EXTN‑001**: 시스템은 향후 기능 추가(예: 다중 서비스 업체 지원, 다양한 결제 수단, 추가 알림 채널 등)에 유연하게 대응할 수 있도록 모듈화된 구조로 설계한다.
* **NF‑EXTN‑002**: 데이터베이스 스키마는 새로운 요구사항을 수용할 수 있도록 설계하며, 필요시 마이그레이션을 통해 확장한다.
* **NF‑EXTN‑003**: 컴포넌트 아키텍처는 재사용성과 조합성을 고려하여 설계하며, 새로운 UI 요소나 기능을 기존 시스템에 쉽게 통합할 수 있도록 한다. (예: `src/features` 기반 모듈화, Presentational/Container 패턴 또는 커스텀 훅을 통한 관심사 분리)
* **NF‑EXTN‑004**: API 설계는 버전 관리를 고려하고, 하위 호환성을 유지하며 새로운 기능을 추가할 수 있도록 한다.

### 테스트 & 운영 (NF‑TEST & OPS)

* **NF‑TEST‑001**: 핵심 로직 단위 테스트 + E2E(Playwright/Cypress) (별도 테스트 계획 수립)
* **NF‑OPS‑001**: Edge Function/PortOne/카카오 API·알림톡 실패 모니터링(Sentry, Slack Webhook 등) (Phase 8 연동)

---

## 6. 페이지별 기능 요구사항 매핑

| 페이지                  | 기능 식별자                               | 주요 내용                                         |
| -------------------- | ------------------------------------ | --------------------------------------------- |
| **P‑000** 회원가입       | F‑AUTH‑007, 008, 010                 | 이메일·비밀번호·이름·휴대폰 입력, 유효성 검사, 가입하기              |
| **P‑001** 로그인        | F‑AUTH‑001, F-AUTH-004~006, 011 (초기: 이메일 중심) <br/> (Phase 8 이후: F-AUTH-002, F-AUTH-003 추가) | 이메일 로그인, 이메일 회원가입·비밀번호 찾기 링크 (Phase 8 이후 소셜 로그인 버튼 추가) |
| **P‑010** 비밀번호 찾기    | F‑AUTH‑012, 013                      | 이메일 입력 → 재설정 링크 발송                            |
| **P‑011** 비밀번호 재설정   | F‑AUTH‑014                           | 새 비밀번호 설정                                     |
| **P‑002** 서비스 상세/예약  | F‑INFO‑001 ~ 005, F‑RESV‑001 ~ 014 | 서비스 정보/리뷰/평점, 날짜·시간 선택, 예약 정보 입력·요약, 예약 완료 버튼 |
| **P‑005** 마이페이지      | F‑MGMT‑U‑001 ~ 009, F‑AUTH‑018      | 예약·리뷰·적립/쿠폰·계정·탈퇴·로그아웃                        |
| **P‑006** 결제         | F‑RESV‑015                           | PortOne 결제 모듈                                 |
| **P‑007** 결제 결과      | F‑RESV‑015, F‑ERR‑001                | 성공/실패 메시지, 이동 버튼                              |
| **P‑008** 예약 변경      | F‑MGMT‑M‑003 ~ 006                  | 날짜·시간 재선택, 실시간 확인, 변경 완료                      |
| **P‑009** 리뷰 작성/수정   | F‑MGMT‑R‑002 ~ 004, 008             | 별점·텍스트·이미지 업로드, 등록/수정 버튼                      |
| **P‑101** 운영자 예약 현황  | F‑MGMT‑O‑003, 004, 008, 012          | 예약 목록/상세, 직변/취소, 대리 예약                        |
| **P‑102** 운영자 예약 설정  | F‑MGMT‑O‑001, 002                    | 예약 규칙·휴무일 설정                                  |
| **P‑103** 운영자 고객 목록  | F‑MGMT‑O‑005 ~ 007                  | 고객 목록, 신규 고객, 쿠폰 부여                           |
| **P‑104** 운영자 고객 추가  | F‑MGMT‑O‑006                         | 고객 정보 입력                                      |
| **P‑105** 운영자 대리 예약  | F‑MGMT‑O‑009 ~ 011                  | 고객 선택/입력, 날짜·시간, 메모, 결제 요청 예약 생성              |
| **P‑106** 운영자 서비스 정보 | F‑MGMT‑B‑001 ~ 003                  | 서비스 기본 정보·이미지·약관 관리                           |
| **P‑107** 운영자 리뷰 관리  | F‑MGMT‑R‑011                         | 리뷰 목록, 숨김/삭제                                  |

---

## 7. 시스템 백엔드 처리 (Supabase Functions 등)

### 인증

* **이메일·비밀번호 인증** (고객/운영자 구분 및 역할 기반 리디렉션)
* **이메일 인증** 처리
* **비밀번호 재설정** 토큰 생성·검증 및 업데이트
* **사용자 세션 관리**·로그아웃
* **회원 탈퇴 처리**: 계정 비활성화 → 30 일 후 익명화
* (Phase 8) **카카오/네이버 로그인 콜백 처리** 및 계정 연동

### 데이터 조회

* 서비스 정보 조회
* 예약 가능 시간 계산 (운영 규칙 + 기존 예약 + 휴무일)
* 사용자 예약 내역 조회 (필터링 기능 포함 - Phase 3)
* 운영자 예약·고객 목록 조회
* 리뷰 목록 조회 (별점 포함)
* 사용자 적립/쿠폰 시간 조회
* 서비스 **평균 별점** 및 **리뷰 수** 조회

### 데이터 저장 / 수정

* **사용자 예약 정보** 저장
* **운영자 서비스 정보** 저장/수정
* **운영자 고객 정보** 저장
* **사용자 정보** 저장/수정 (가입 방식, 해시된 비밀번호 등)
* **휴무일 정보** 저장/수정
* **대리 예약 정보** 저장 (`admin_memo` 포함)
* **대리 예약 결제 완료** → 예약 상태 수정 (Phase 7)
* **예약 변경** → `status='modified'` (동시성·원자성 보장), 관련 요금 정보 업데이트 (Phase 3-3에서 기반 마련, Phase 7에서 실제 처리)
* **예약 취소** → `status='cancelled'`
* **리뷰 정보** 저장/수정 (별점, 이미지 URL)
* 리뷰 **상태 변경** (사용자 삭제, 운영자 숨김/삭제)
* 리뷰 **등록 시 적립 시간 부여** (`customers` 업데이트)
* 예약 시 **사용된 쿠폰 상태** 변경 (`customer_coupons`) + 적립 시간 차감 (Phase 4)
* **운영자 쿠폰 부여** → `customer_coupons` Insert
* **회원 탈퇴** → 사용자 정보 비활성화/익명화
* (고려) 리뷰 등록/수정/삭제 시 **서비스 평균 별점·리뷰 수** 업데이트

### 결제 처리 (Phase 7)

* PortOne **결제 요청** (최소 1 시간 요금 + 할인 적용)
* PortOne **웹훅 수신** 및 **API 검증**
* 결제 결과 처리 (예약 확정, 사용 시간 차감, 관련 웹훅 발생)
* PortOne **환불 API** (예약 취소, 예약 변경 시 부분 환불)

### 알림 (Phase 8)

* **예약 확정 알림 웹훅 발송** (Make/n8n 연동)
* **카카오 알림톡 API** 연동 및 시나리오별 메시지 발송 (임박, 변경, 취소 등)
* **이메일 인증 메일** 발송

### 이미지 처리

* 운영자·리뷰 **이미지 Storage** 저장 및 URL 관리

### 오류 처리

* 각 API·함수 실행 중 발생 가능한 **오류 처리 및 로깅** (Sentry 연동 고려 - Phase 8)

### 개념적 데이터 모델 *(상세 설계는 별도 문서)*

| 테이블                          | 주요 컬럼 및 설명                                                                                                                     |
| ---------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| **customers** | 인증 정보(이메일·비밀번호 해시·소셜 연동 ID), 프로필(이름·연락처·이미지), `role`(customer/admin), `auth_provider` (email/kakao/naver), `accumulated_time_minutes`, 활성 상태 등                         |
| **reservations** | 서비스·시간·고객·상태(`confirmed`/`modified`/`cancelled`…), 운영자 메모, `used_coupon_ids`, `used_accumulated_time_minutes`, `paid_amount`, `payment_id`, `refunded`, `refunded_at` 등. 연장된 예약의 경우, `end_time`이 업데이트되고, `paid_amount`에 연장 요금이 누적되며, `used_coupon_ids`, `used_accumulated_time_minutes`도 연장 시 사용분을 반영하여 업데이트된다. 필요시 `operator_memo`에 연장 관련 특이사항(예: Grace Period 적용)을 기록할 수 있다. `status` 필드는 예약의 확정 상태를 관리하며, `confirmed` 상태의 예약은 중복될 수 없도록 DB 레벨에서 제어된다 (DB 스키마 문서 참조). 예약 변경으로 인한 요금 변동 시 관련 정보(예: `recalculated_total_amount`, `pending_payment_amount`, `pending_refund_amount`, `additional_payment_id`, `partial_refund_amount`, `partial_refund_at`) 기록 필드 고려. |
| **reviews** | 작성자, 예약·서비스 정보, 별점, 텍스트, 이미지 URL 목록, 숨김/삭제 상태 등                                                                                |
| **services** | 공간 정보(이름·설명·가격·이미지), 평균 별점, 리뷰 수 등                                                                                             |
| **customer_coupons** | 고객 ID, 쿠폰 값(30 분), 부여/만료/사용 일시, 사용된 예약 ID 등                                                                                    |
| *(확장)* **businesses** | 입점 업체 정보                                                                                                                       |
| *(확장)* **business_members** | 고객‑업체 관계 및 역할                                                                                                                  |
| *(고려)* **holidays** | 운영자 휴무일 정보 *(또는 `services` 내 관리)* |
| **service_operating_hours** | 서비스 ID, 요일(day_of_week, KST 기준), 시작 시간(start_time, HH:MM, KST 기준), 종료 시간(end_time, HH:MM, KST 기준, 익일 00:00은 '24:00' 또는 '00:00'으로 표현 가능하며 24시간 운영 등 다양한 시나리오 지원), 휴무 여부(is_closed) 등을 포함. |

---

## 8. 오픈 이슈 (Open Issues)

1. **쿠폰 유효 기간 정책**

   * 쿠폰에 유효 기간을 설정할지 결정 필요.
   * *제안*: 발급일로부터 **3 개월** 유효.

2. **쿠폰·할인 정책 구체화**

   * 첫 예약 할인, 특정 기간/시간대 할인 등 세부 로직·UI 설계 필요.

3. **운영자 역할 세분화 & RBAC**

   * 역할 정의·도입 시점 결정.
   * *현재*: 단일 **'admin'** 역할 유지 → 향후 필요 시 확장.

4. **API 명세 관리 방식**

   * 간단한 **마크다운 표 형식**으로 관리 여부 결정.

---
end of document
